
name: Generic.Forensic.SQLiteHunter
description: |
    Hunt for SQLite files.
    
    SQLite has become the de-facto standard for storing application data,
    in many types of applications:
    
    - Web Browsers
    - Operating Systems
    - Various applications, such as iMessage, TCC etc
    
    This artifact can hunt for these artifacts in a mostly automated way.
    More info at https://github.com/Velocidex/SQLiteHunter
    
    NOTE: If you want to use this artifact on just a bunch of files already
    collected (for example the files collected using the
    Windows.KapeFiles.Targets artifact) you can use the CustomGlob parameter
    (for example set it to "/tmp/unpacked/**" to consider all files in the
    unpacked directory).
    
    

column_types:
- name: Image
  type: preview_upload

export: |
  LET SPEC <= "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"
  LET Specs <= parse_json(data=gunzip(string=base64decode(string=SPEC)))
  LET CheckHeader(OSPath) = read_file(filename=OSPath, length=12) = "SQLite forma"
  LET Bool(Value) = if(condition=Value, then="Yes", else="No")

  -- In fast mode we check the filename, then the header then run the sqlite precondition
  LET matchFilename(SourceName, OSPath) = OSPath =~ get(item=Specs.sources, field=SourceName).filename
    AND CheckHeader(OSPath=OSPath)
    AND Identify(SourceName= SourceName, OSPath= OSPath)
    AND log(message=format(format="%v matched by filename %v",
            args=[OSPath, get(item=Specs.sources, field=SourceName).filename]))

  -- If the user wanted to also upload the file, do so now
  LET MaybeUpload(OSPath) = if(condition=AlsoUpload, then=upload(file=OSPath)) OR TRUE

  LET Identify(SourceName, OSPath) = SELECT if(
    condition=CheckHeader(OSPath=OSPath),
    then={
      SELECT *
      FROM sqlite(file=OSPath, query=get(item=Specs.sources, field=SourceName).id_query)
    }) AS Hits
  FROM scope()
  WHERE if(condition=Hits[0].Check = get(item=Specs.sources, field=SourceName).id_value,
    then= log(message="%v was identified as %v",
            args=[OSPath, get(item=Specs.sources, field=SourceName).Name]),
    else=log(message="%v was not identified as %v (got %v, wanted %v)",
             args=[OSPath, get(item=Specs.sources, field=SourceName).Name, str(str=Hits),
                   get(item=Specs.sources, field=SourceName).id_value]) AND FALSE)

  LET ApplyFile(SourceName) = SELECT * FROM foreach(row={
     SELECT OSPath FROM AllFiles
     WHERE if(condition=MatchFilename,  then=matchFilename(SourceName=SourceName, OSPath=OSPath),
      else=Identify(SourceName= SourceName, OSPath= OSPath))

  }, query={
     SELECT *, OSPath FROM sqlite(
        file=OSPath, query=get(item=Specs.sources, field=SourceName).SQL)
  })

  -- Filter for matching files without sqlite checks.
  LET FilterFile(SourceName) =
     SELECT OSPath FROM AllFiles
     WHERE if(condition=MatchFilename,
              then=OSPath =~ get(item=Specs.sources, field=SourceName).filename)

  -- Build a regex for all enabled categories.
  LET all_categories = SELECT _value FROM foreach(row=["All","MacOS","Chrome","Browser","Edge","Firefox","InternetExplorer","Windows"]) WHERE get(field=_value)
  LET category_regex <= join(sep="|", array=all_categories._value)
  LET AllGlobs <= filter(list=Specs.globs, condition="x=> x.tags =~ category_regex")
  LET _ <= log(message="Globs for category %v is %v", args=[category_regex, CustomGlob || AllGlobs.glob])
  LET AllFiles <= SELECT OSPath FROM glob(globs=CustomGlob || AllGlobs.glob)
    WHERE NOT IsDir AND MaybeUpload(OSPath=OSPath)

parameters:
- name: MatchFilename
  description: |
    If set we use the filename to detect the type of sqlite file.
    When unset we use heristics (slower)
  type: bool
  default: Y

- name: CustomGlob
  description: Specify this glob to select other files

- name: DateAfter
  description: Timebox output to rows after this time.
  type: timestamp
  default: "1970-01-01T00:00:00Z"

- name: DateBefore
  description: Timebox output to rows after this time.
  type: timestamp
  default: "2100-01-01T00:00:00Z"

- name: FilterRegex
  description: Filter critical rows by this regex
  type: regex
  default: .


- name: All
  description: Select targets with category All
  type: bool
  default: Y


- name: MacOS
  description: Select targets with category MacOS
  type: bool
  default: N


- name: Chrome
  description: Select targets with category Chrome
  type: bool
  default: N


- name: Browser
  description: Select targets with category Browser
  type: bool
  default: N


- name: Edge
  description: Select targets with category Edge
  type: bool
  default: N


- name: Firefox
  description: Select targets with category Firefox
  type: bool
  default: N


- name: InternetExplorer
  description: Select targets with category InternetExplorer
  type: bool
  default: N


- name: Windows
  description: Select targets with category Windows
  type: bool
  default: N


- name: SQLITE_ALWAYS_MAKE_TEMPFILE
  type: bool
  default: Y

- name: AlsoUpload
  description: If specified we also upload the identified file.
  type: bool

sources:
- name: AllFiles
  query: |
    SELECT * FROM AllFiles


- name: iMessage_Profiles
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="iMessage_Profiles")
    SELECT timestamp(epoch=date / 1000000000 + 978307200) AS Timestamp, *
    FROM Rows
    WHERE Timestamp > DateAfter AND Timestamp < DateBefore
      AND (MessageText, RoomName) =~ FilterRegex
    


- name: Chromium Browser Autofill_Profiles
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Autofill_Profiles")
    SELECT GUID,
      timestamp(epoch= date_modified) AS DateModified,
      timestamp(epoch= use_date) AS UseDate,
      FirstName, MiddleName, LastName, EmailAddress,
      PhoneNumber, CompanyName, StreetAddress,
      City, State, ZipCode, UseCount, OSPath
    FROM Rows
    WHERE UseDate > DateAfter AND UseDate < DateBefore
      AND (FirstName, MiddleName, LastName, EmailAddress, CompanyName, StreetAddress) =~ FilterRegex
    


- name: Chromium Browser Autofill_Masked Credit Cards
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Autofill_Masked Credit Cards")
    SELECT * FROM Rows


- name: Chromium Browser Bookmarks
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Chromium Browser Bookmarks")
    -- Recursive function to report the details of a folder
    LET ReportFolder(Data, BaseName) = SELECT * FROM chain(a={
      -- First row emit the data about the actual folder
      SELECT BaseName + " | " + Data.name AS Name,
             timestamp(winfiletime=int(int=Data.date_added) * 10) AS DateAdded,
             timestamp(winfiletime=int(int=Data.date_last_used) * 10) AS DateLastUsed,
             Data.type AS Type,
             Data.url || ""  AS URL
      FROM scope()
    },
    b={
       -- If this folder has children recurse into it
       SELECT * FROM foreach(row={
          SELECT _value FROM items(item=Data.children)
       },  query={
          SELECT * FROM ReportFolder(Data=_value, BaseName=BaseName + " | " + Data.name)
       })
    })
    
    LET MatchingFiles = SELECT OSPath, parse_json(data=read_file(filename=OSPath)) AS Data
    FROM Rows
    
    SELECT * FROM foreach(row=MatchingFiles, query={
      SELECT * FROM chain(
      a={
        SELECT OSPath, *, "bookmark_bar" AS Type
        FROM ReportFolder(Data=Data.roots.bookmark_bar, BaseName="")
      },
      b={
        SELECT OSPath, *, "other" AS Type
        FROM ReportFolder(Data=Data.roots.other, BaseName="")
      },
      c={
        SELECT OSPath, *, "synced" AS Type
        FROM ReportFolder(Data=Data.roots.synced, BaseName="")
      })
    })
    


- name: Chromium Browser_Cookies
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser_Cookies")
    SELECT timestamp(winfiletime=(creation_utc * 10) || 0) AS CreationUTC,
           timestamp(winfiletime=(expires_utc * 10) || 0) AS ExpiresUTC,
           timestamp(winfiletime=(last_access_utc * 10) || 0) AS LastAccessUTC,
           HostKey, Name, Path,
           Bool(Value=is_secure) AS IsSecure,
           Bool(Value=is_httponly) AS IsHttpOnly,
           Bool(Value=has_expires) AS HasExpiration,
           Bool(Value=is_persistent) AS IsPersistent,
           Priority, SourcePort, OSPath
    FROM Rows
    WHERE LastAccessUTC > DateAfter AND LastAccessUTC < DateBefore
      AND (Name, Path) =~ FilterRegex
    


- name: Chromium Browser Extensions
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Chromium Browser Extensions")
    -- Resolve the message string against the Locale dict
    LET ResolveName(Message, Locale) = get(item=Locale,
          field=lowcase(string=parse_string_with_regex(regex="^__MSG_(.+)__$", string=Message).g1),
          default=Message).message || Message
    
    -- Read the manifest files
    LET ManifestData = SELECT OSPath, parse_json(data=read_file(filename=OSPath)) AS Manifest
    FROM Rows
    
    -- Find the Locale file to help with.
    LET LocaleData = SELECT *, if(condition=Manifest.default_locale, else=dict(),
         then=parse_json(data=read_file(
            filename=OSPath.Dirname + "_locales" + Manifest.default_locale + "messages.json"))) AS Locale
    FROM ManifestData
    
    LET GetIcon(Manifest) = Manifest.icons.`128` || Manifest.icons.`64` || Manifest.icons.`32` || Manifest.icons.`16`
    
    SELECT OSPath, Manifest.author.email AS Email,
      ResolveName(Message = Manifest.name, Locale=Locale) AS name,
      ResolveName(Message = Manifest.description, Locale=Locale) AS description,
      Manifest.oauth2.scopes as Scopes,
      Manifest.permissions as Permissions,
      Manifest.key as Key, if(condition=GetIcon(Manifest=Manifest),
                then=upload(file=OSPath.Dirname + GetIcon(Manifest=Manifest))) AS Image,
      Manifest AS _Manifest
    FROM LocaleData
    WHERE (name, description) =~ FilterRegex
    


- name: Chromium Browser Favicons
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Favicons")
    SELECT ID, IconID,
      timestamp(winfiletime= (LastUpdated * 10) || 0) AS LastUpdated,
      PageURL, FaviconURL,
      upload(accessor="data",
         file=_image,
         name=format(format="Image%v.png", args=ID)) AS Image,
      OSPath as _OSPath
    FROM Rows
    WHERE LastUpdated > DateAfter AND LastUpdated < DateBefore
    


- name: Chromium Browser History_Visits
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser History_Visits")
    SELECT ID,
       timestamp(winfiletime=(visit_time * 10) || 0) AS VisitTime,
       timestamp(winfiletime=(last_visit_time * 10) || 0) AS LastVisitedTime,
       URLTitle, URL, VisitCount, TypedCount,
       if(condition=hidden =~ '1', then="Yes", else="No") AS Hidden,
       VisitID, FromVisitID,
       visit_duration / 1000000 AS VisitDurationInSeconds,
       OSPath
    FROM Rows
    WHERE VisitTime > DateAfter
      AND VisitTime < DateBefore
      AND (URLTitle, URL) =~ FilterRegex
    


- name: Chromium Browser History_Downloads
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser History_Downloads")
    LET StateLookup <= dict(`0`='In Progress', `1`='Complete', `2`="Cancelled", `3`="Interrupted", `4`="Interrupted")
    LET DangerType <= dict(`0`='Not Dangerous', `1`="Dangerous", `2`='Dangerous URL', `3`='Dangerous Content',
        `4`='Content May Be Malicious', `5`='Uncommon Content', `6`='Dangerous But User Validated',
        `7`='Dangerous Host', `8`='Potentially Unwanted', `9`='Whitelisted by Policy')
    LET InterruptReason <= dict(`0`= 'No Interrupt', `1`= 'File Error', `2`='Access Denied', `3`='Disk Full',
      `5`='Path Too Long',`6`='File Too Large', `7`='Virus', `10`='Temporary Problem', `11`='Blocked',
      `12`='Security Check Failed', `13`='Resume Error', `20`='Network Error', `21`='Operation Timed Out',
      `22`='Connection Lost', `23`='Server Down', `30`='Server Error', `31`='Range Request Error',
      `32`='Server Precondition Error', `33`='Unable to get file', `34`='Server Unauthorized',
      `35`='Server Certificate Problem', `36`='Server Access Forbidden', `37`='Server Unreachable',
      `38`='Content Length Mismatch', `39`='Cross Origin Redirect', `40`='Cancelled', `41`='Browser Shutdown',
      `50`='Browser Crashed')
    
    SELECT ID, GUID, CurrentPath, TargetPath, OriginalMIMEType, ReceivedBytes, TotalBytes,
      timestamp(winfiletime=(start_time * 10) || 0) AS StartTime,
      timestamp(winfiletime=(end_time * 10) || 0) AS EndTime,
      timestamp(winfiletime=(opened * 10) || 0) AS Opened,
      timestamp(winfiletime=(last_access_time * 10) || 0) AS LastAccessTime,
      timestamp(epoch=last_modified) AS LastModified,
      get(item=StateLookup, field=str(str=state), default="Unknown") AS State,
      get(item=DangerType, field=str(str=danger_type), default="Unknown") AS DangerType,
      get(item=InterruptReason, field=str(str=interrupt_reason), default="Unknown") AS InterruptReason,
      ReferrerURL, SiteURL, TabURL, TabReferrerURL, DownloadURL, OSPath
    FROM Rows
    WHERE LastAccessTime > DateAfter AND LastAccessTime < DateBefore
      AND (SiteURL, DownloadURL, TabURL, TabReferrerURL, ReferrerURL, DownloadURL) =~ FilterRegex
    


- name: Chromium Browser History_Keywords
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser History_Keywords")
    SELECT KeywordID, URLID,
       timestamp(winfiletime=(last_visit_time * 10) || 0) AS LastVisitedTime,
       KeywordSearchTerm, Title, URL, OSPath
    FROM Rows
    WHERE LastVisitedTime > DateAfter AND LastVisitedTime < DateBefore
      AND (Title, KeywordSearchTerm, URL) =~ FilterRegex
    


- name: Chromium Browser Media_History
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Media_History")
    SELECT ID, URL, WatchTimeSeconds,
       Bool(Value=has_video) AS HasVideo,
       Bool(Value=has_audio) AS HasAudio,
       timestamp(winfiletime=last_updated_time_s || 0) AS LastUpdated,
       OriginID, OSPath
    FROM Rows
    WHERE LastUpdated > DateAfter AND LastUpdated < DateBefore
      AND URL =~ FilterRegex
    


- name: Chromium Browser Media_Playback Session
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Media_Playback Session")
    SELECT ID,
      timestamp(winfiletime=last_updated_time_s || 0) AS LastUpdated, URL,
      duration_ms / 1000 AS DurationInSeconds,
      position_ms / 1000 AS PositionInSeconds,
      Title, Artist, Album, SourceTitle, OriginID, OSPath
    FROM Rows
    WHERE LastUpdated > DateAfter AND LastUpdated < DateBefore
      AND URL =~ FilterRegex
    


- name: Chromium Browser Network_Predictor
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Network_Predictor")
    SELECT * FROM Rows
    WHERE UserText =~ FilterRegex
    


- name: Chromium Browser Notifications_Site Engagements
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Chromium Browser Notifications_Site Engagements")
    LET JSON = SELECT parse_json(data=read_file(filename=OSPath)) AS Data, OSPath FROM Rows
    
    SELECT * FROM foreach(row={
      SELECT OSPath, Data.profile.content_settings.exceptions AS exceptions FROM JSON
    },  query={
      SELECT _key AS Site,
         timestamp(winfiletime=int(int=_value.last_modified) * 10 || 0) AS LastModified,
         timestamp(winfiletime=int(int=_value.setting.lastEngagementTime) * 10 || 0) AS LastEngagementTime,
         OSPath
      FROM items(item=exceptions.site_engagement)
    })
    


- name: Chromium Browser Notifications_App Banners
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Chromium Browser Notifications_App Banners")
    LET JSON = SELECT parse_json(data=read_file(filename=OSPath)) AS Data, OSPath FROM Rows
    
    SELECT * FROM foreach(row={
      SELECT OSPath, Data.profile.content_settings.exceptions AS exceptions FROM JSON
    },  query={
      SELECT _key AS Site,
         timestamp(winfiletime=int(int=_value.last_modified) * 10 || 0) AS LastModified,
         {
           SELECT _key AS Site,
              timestamp(winfiletime=int(int=_value.couldShowBannerEvents) * 10 || 0) AS CouldShowBannerEvents,
              timestamp(winfiletime=int(int=_value.next_install_text_animation.last_shown) * 10 || 0) AS LastShown
           FROM items(item=_value.setting)
         } AS Setting,
         OSPath
      FROM items(item=exceptions.app_banner)
    })
    


- name: Chromium Browser Notifications_Notification Preferences
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Chromium Browser Notifications_Notification Preferences")
    LET ContentSettings <= array(`0`="Default",`1`="Allow",`2`="Block",`3`="Ask",`4`="Session Only",`5`="Detect Important Content")
    
    LET JSON = SELECT parse_json(data=read_file(filename=OSPath)) AS Data, OSPath FROM Rows
    
    SELECT * FROM foreach(row={
      SELECT OSPath, Data.profile.content_settings.exceptions AS exceptions FROM JSON
    },  query={
      SELECT _key AS Site,
        timestamp(winfiletime=int(int=_value.last_modified) * 10 || 0) AS LastModified,
        ContentSettings[_value.setting] AS Setting,
        OSPath
      FROM items(item=exceptions.notifications)
    })
    


- name: Chromium Browser Notifications_Notification Interactions
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Chromium Browser Notifications_Notification Interactions")
    LET JSON = SELECT parse_json(data=read_file(filename=OSPath)) AS Data, OSPath FROM Rows
    LET S = scope()
    
    SELECT * FROM foreach(row={
      SELECT OSPath, Data.profile.content_settings.exceptions AS exceptions FROM JSON
    },  query={
      SELECT _key AS URL,
        timestamp(winfiletime=int(int=_value.last_modified) * 10 || 0) AS LastModified,
        _value.display_count as DisplayCount,
        _value.click_count as ClickCount,
        OSPath
      FROM items(item=S.notification_interactions || dict())
    })
    


- name: Chromium Browser Shortcuts
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Shortcuts")
    SELECT ID,
      timestamp(winfiletime= (last_access_time * 10) || 0) AS LastAccessTime,
      TextTyped, FillIntoEdit, URL, Contents,
      Description, Type, Keyword, TimesSelectedByUser, OSPath
    FROM Rows
    WHERE LastAccessTime > DateAfter AND LastAccessTime < DateBefore
      AND (Contents, Description) =~ FilterRegex
    


- name: Chromium Sessions_Sessions
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Sessions_Sessions")
    SELECT timestamp(winfiletime=(creation_utc * 10) || 0) AS CreationUTC,
           timestamp(winfiletime=(expires_utc * 10) || 0) AS ExpiresUTC,
           timestamp(winfiletime=(last_access_utc * 10) || 0) AS LastAccessUTC,
           HostKey, Name, Path,
           Bool(Value=is_secure) AS IsSecure,
           Bool(Value=is_httponly) AS IsHttpOnly,
           Bool(Value=has_expires) AS HasExpiration,
           Bool(Value=is_persistent) AS IsPersistent,
           Priority, SourcePort, OSPath
    FROM Rows
    WHERE LastAccessUTC > DateAfter AND LastAccessUTC < DateBefore
      AND (Name, Path) =~ FilterRegex
    


- name: Chromium Browser Top Sites
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Top Sites")
    SELECT * FROM Rows
    WHERE ( URL =~ FilterRegex OR Title =~ FilterRegex )
    


- name: Edge Browser Navigation History_Navigation History
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Edge Browser Navigation History_Navigation History")
    SELECT ID,
       timestamp(epoch=`Last Visited Time`) AS `Last Visited Time`,
       Title, URL, VisitCount, OSPath
    FROM Rows
    WHERE `Last Visited Time` > DateAfter
      AND `Last Visited Time` < DateBefore
      AND (Title, URL) =~ FilterRegex
    


- name: Firefox Places
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Places")
    LET BookmarkTypes <= dict(`1`="URL", `2`="Folder", `3`="Separator")
    SELECT ID, ParentID,
       get(item= BookmarkTypes, field=str(str=type), default="Unknown") AS Type,
       timestamp(epoch=dateAdded) AS DateAdded,
       timestamp(epoch=lastModified) AS LastModified,
       Position, Title, URL, ForeignKey, OSPath
    FROM Rows
    WHERE LastModified > DateAfter AND LastModified < DateBefore
      AND (Title, URL) =~ FilterRegex
    


- name: Firefox Places_Downloads
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Places_Downloads")
    SELECT PlaceID, Content,
       timestamp(epoch=dateAdded) AS DateAdded,
       timestamp(epoch=lastModified) AS LastModified,
       OSPath
    FROM Rows
    WHERE LastModified > DateAfter AND LastModified < DateBefore
      AND Content =~ FilterRegex
    


- name: Firefox Places_History
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Places_History")
    LET VisitType <= dict(`1`='TRANSITION_LINK', `2`='TRANSITION_TYPED', `3`='TRANSITION_BOOKMARK',
      `4`='TRANSITION_EMBED', `5`= 'TRANSITION_REDIRECT_PERMANENT', `6`='TRANSITION_REDIRECT_TEMPORARY',
      `7`='TRANSITION_DOWNLOAD', `8`='TRANSITION_FRAMED_LINK', `9`='TRANSITION_RELOAD')
    
    SELECT VisitID, FromVisitID,
       timestamp(epoch= last_visit_date) AS LastVisitDate,
       VisitCount, URL, Title, Description,
       get(item= VisitType, field=str(str=visit_type), default="Unknown") AS VisitType,
       Bool(Value=hidden) AS Hidden,
       Bool(Value=typed) AS Typed,
       Frecency, PreviewImageURL, OSPath
    FROM Rows
    WHERE LastVisitDate > DateAfter AND LastVisitDate < DateBefore
      AND (Title, URL, Description) =~ FilterRegex
    


- name: Firefox Cookies
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Cookies")
    SELECT ID, Host, Name, Value,
       timestamp(epoch= creationTime) AS CreationTime,
       timestamp(epoch= lastAccessed) AS LastAccessedTime,
       timestamp(epoch= expiry) AS Expiration,
       Bool(Value= isSecure) AS IsSecure,
       Bool(Value= isHttpOnly) AS IsHTTPOnly, OSPath
    FROM Rows
    WHERE LastAccessedTime > DateAfter
      AND LastAccessedTime < DateBefore
      AND ( Name =~ FilterRegex OR Value =~ FilterRegex )
    


- name: Firefox Downloads
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Downloads")
    SELECT ID, Name, MIMEType, Source, Target,
       timestamp(epoch= startTime) AS StartTime,
       timestamp(epoch= endTime) AS EndTime,
       timestamp(epoch= expiry) AS Expiration,
       CurrentBytes, MaxBytes, OSPath
    FROM Rows
    WHERE StartTime > DateAfter
      AND StartTime < DateBefore
      AND Name =~ FilterRegex
    


- name: Firefox Favicons
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Favicons")
    SELECT ID, PageURL, FaviconURL,
       timestamp(epoch= expire_ms) AS Expiration,
       OSPath
    FROM Rows
    


- name: Firefox Form History
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Form History")
    SELECT ID, FieldName, Value, TimesUsed,
       timestamp(epoch= firstUsed) AS FirstUsed,
       timestamp(epoch= lastUsed) AS LastUsed,
       GUID, OSPath
    FROM Rows
    WHERE LastUsed > DateAfter AND LastUsed < DateBefore
      AND ( FieldName =~ FilterRegex OR Value =~ FilterRegex )
    


- name: IE or Edge WebCacheV01_All Data
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="IE or Edge WebCacheV01_All Data")
    LET MatchingFiles = SELECT OSPath FROM Rows
    
    LET Containers(OSPath) = SELECT Table
    FROM parse_ese_catalog(file=OSPath)
    WHERE Table =~ "Container_"
    GROUP BY Table
    
    LET AllHits(OSPath) = SELECT * FROM foreach(row={
        SELECT * FROM Containers(OSPath=OSPath)
    }, query={
       SELECT timestamp(winfiletime=ExpiryTime) AS ExpiryTime,
          timestamp(winfiletime=ModifiedTime) AS ModifiedTime,
          timestamp(winfiletime=AccessedTime) AS AccessedTime, Url, *
       FROM parse_ese(file=OSPath, table=Table)
    })
    
    SELECT * FROM foreach(row=MatchingFiles, query={
      SELECT * FROM AllHits(OSPath=OSPath)
    })
    WHERE AccessedTime > DateAfter AND AccessedTime < DateBefore
      AND Url =~ FilterRegex
    


- name: IE or Edge WebCacheV01_Highlights
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="IE or Edge WebCacheV01_Highlights")
    SELECT * FROM foreach(row=MatchingFiles, query={
      SELECT AccessedTime, ModifiedTime, ExpiryTime, Url
      FROM AllHits(OSPath=OSPath)
    })
    WHERE AccessedTime > DateAfter AND AccessedTime < DateBefore
      AND Url =~ FilterRegex
    


- name: MacOS Applications Cache
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="MacOS Applications Cache")
    SELECT
       time_stamp AS Timestamp,
       OSPath.Base AS Application,
       entry_ID AS EntryID,
       version AS Version,
       hash_value AS Hash,
       storage_policy AS StoragePolicy,
       request_key AS URL,
       plist(file=request_object, accessor="data") AS Request,
       plist(file=response_object, accessor="data") AS Response,
       partition AS Partition,
       OSPath
    FROM Rows
    WHERE Timestamp > DateAfter AND Timestamp < DateBefore
      AND Application =~ FilterRegex
    


- name: MacOS NetworkUsage
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="MacOS NetworkUsage")
    SELECT timestamp(epoch= ZTIMESTAMP + 978307200) AS Timestamp,
      timestamp(epoch= ZFIRSTTIMESTAMP + 978307200) AS FirstTimestamp,
      timestamp(epoch= LIVE_USAGE_TIMESTAMP + 978307200) AS LiveUsageTimestamp,
      ZBUNDLENAME AS BundleID,
      ZPROCNAME AS ProcessName,
      ZWIFIIN AS WifiIn,
      ZWIFIOUT AS WifiOut,
      ZWWANIN AS WanIn,
      ZWWANOUT AS WandOut,
      ZWIREDIN AS WiredIn,
      ZWIREDOUT AS WiredOut,
      ZXIN AS _XIn,
      ZXOUT AS _XOut,
      Z_PK AS LiveUsageTableID
    FROM Rows
    


- name: MacOS Notes
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="MacOS Notes")
    SELECT Key AS _Key,
     OSPath[1] AS User,
     Note,
     Title,
     Snippet,
     NoteID AS _NoteID,
     timestamp(cocoatime=CreatedTS) AS CreatedTime,
     timestamp(cocoatime=LastOpenedDate) AS LastOpenedTime,
     timestamp(cocoatime=DirModificationDate) AS LastDirModifcation,
     Account AS _Account,
     Directory,
     DirectoryID,
     AttachmentName,
     AttachmentSize,
     AttachmentUUID,
     if(condition=AttachmentUUID,
        then=OSPath[:2] + '/Library/Group Containers/group.com.apple.notes/Accounts/LocalAccount/Media/' + AttachmentUUID + '/' + AttachmentName) AS AttachmentLocation,
     AccountName AS _AccountName,
     AccountID AS _AccountID,
     AccountType AS _AccountType,
     gunzip(string=Data) AS Data,
     OSPath
    FROM Rows
    WHERE LastOpenedTime > DateAfter AND LastOpenedTime < DateBefore
      AND ( Title =~ FilterRegex OR Data =~ FilterRegex )
    


- name: MacOS XProtect Detections
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="MacOS XProtect Detections")
    SELECT *
    FROM Rows
    


- name: Windows Activities Cache_ActivityPackageId
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Windows Activities Cache_ActivityPackageId")
    SELECT format(format="%0X-%0X-%0X-%0X-%0X", args=[
      ActivityId[0:4], ActivityId[4:6], ActivityId[6:8],
      ActivityId[8:10], ActivityId[10:] ]) AS ActivityId,
      Platform, PackageName, ExpirationTime, OSPath
    FROM Rows
    


- name: Windows Activities Cache_Clipboard
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Windows Activities Cache_Clipboard")
    SELECT
      CreatedTime,
      timestamp(epoch=LastModifiedTime) AS LastModifiedTime,
      timestamp(epoch=LastModifiedOnClient) AS LastModifiedOnClient,
      StartTime,
      EndTime,
      Payload,
      OSPath[1] AS User,
      base64decode(string=parse_json_array(data=ClipboardPayload)[0].content) AS ClipboardPayload,
      OSPath AS Path,
      Mtime
    FROM Rows
    WHERE StartTime > DateAfter
      AND StartTime < DateBefore
      AND ClipboardPayload =~ FilterRegex
    


- name: Windows Search Service_SystemIndex_Gthr
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Windows Search Service_SystemIndex_Gthr")
    LET MatchingFiles = SELECT OSPath FROM Rows
    
    LET FormatTimeB(T) = timestamp(winfiletime=parse_binary(
       filename=T, accessor="data", struct="uint64b"))
    
    LET FormatTime(T) = timestamp(winfiletime=parse_binary(
       filename=T, accessor="data", struct="uint64"))
    
    LET FormatSize(T) = parse_binary(
       filename=T, accessor="data", struct="uint64")
    
    SELECT * FROM foreach(row=MatchingFiles, query={
       SELECT ScopeID, DocumentID, SDID,
          FormatTimeB(T=LastModified) AS LastModified,
          FileName
       FROM parse_ese(file=OSPath, table= "SystemIndex_Gthr")
    })
    WHERE LastModified > DateAfter AND LastModified < DateBefore
      AND FileName =~ FilterRegex
    


- name: Windows Search Service_SystemIndex_GthrPth
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Windows Search Service_SystemIndex_GthrPth")
    SELECT * FROM foreach(row=MatchingFiles, query={
       SELECT Scope, Parent, Name
       FROM parse_ese(file=OSPath, table= "SystemIndex_GthrPth")
    })
    WHERE Name =~ FilterRegex
    


- name: Windows Search Service_SystemIndex_PropertyStore
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Windows Search Service_SystemIndex_PropertyStore")
    LET X = scope()
    
    -- The PropertyStore columns look like
    -- <random>-ProperName so we strip the
    -- random part off to display it properly.
    LET FilterDict(Dict) = to_dict(item={
      SELECT split(sep_string="-", string=_key)[1] || _key AS _key, _value
      FROM items(item=Dict)
    })
    
    LET PropStore(OSPath) = SELECT *,
       FormatTime(T=X.System_Search_GatherTime) AS System_Search_GatherTime,
       FormatSize(T=X.System_Size) AS System_Size,
       FormatTime(T=X.System_DateModified) AS System_DateModified,
       FormatTime(T=X.System_DateAccessed) AS System_DateAccessed,
       FormatTime(T=X.System_DateCreated) AS System_DateCreated
    FROM foreach(row={
       SELECT *, FilterDict(Dict=_value) AS _value
       FROM items(item={
         SELECT * FROM parse_ese(file=OSPath, table="SystemIndex_PropertyStore")
      })
    }, column="_value")
    
    SELECT * FROM foreach(row=MatchingFiles, query={
       SELECT *
       FROM PropStore(OSPath=OSPath)
    })
    WHERE System_DateAccessed > DateAfter AND System_DateAccessed < DateBefore
    


- name: Windows Search Service_SystemIndex_PropertyStore_Highlights
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Windows Search Service_SystemIndex_PropertyStore_Highlights")
    SELECT * FROM foreach(row=MatchingFiles, query={
       SELECT WorkID,
          System_Search_GatherTime,
          System_Size,
          System_DateModified,
          System_DateCreated,
          X.System_FileOwner AS System_FileOwner,
          X.System_ItemPathDisplay AS System_ItemPathDisplay,
          X.System_ItemType AS System_ItemType,
          X.System_FileAttributes AS System_FileAttributes,
          X.System_Search_AutoSummary AS System_Search_AutoSummary
       FROM PropStore(OSPath=OSPath)
    })
    WHERE System_DateAccessed > DateAfter AND System_DateAccessed < DateBefore
    


- name: Windows Search Service_BrowsingActivity
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Windows Search Service_BrowsingActivity")
    SELECT * FROM foreach(row=MatchingFiles, query={
       SELECT X.ItemPathDisplay AS ItemPathDisplay,
          X.Activity_ContentUri AS Activity_ContentUri,
          X.Activity_Description AS Activity_Description
       FROM PropStore(OSPath=OSPath)
       WHERE Activity_ContentUri
    })
    


- name: Windows Search Service_UserActivityLogging
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Windows Search Service_UserActivityLogging")
    SELECT * FROM foreach(row=MatchingFiles, query={
       SELECT X.System_ItemPathDisplay AS System_ItemPathDisplay,
           FormatTime(T=X.ActivityHistory_StartTime) AS ActivityHistory_StartTime,
           FormatTime(T=X.ActivityHistory_EndTime) AS ActivityHistory_EndTime,
           X.ActivityHistory_AppId AS ActivityHistory_AppId
       FROM PropStore(OSPath=OSPath)
       WHERE ActivityHistory_AppId
    })
    WHERE ActivityHistory_StartTime > DateAfter
      AND ActivityHistory_StartTime < DateBefore
    



