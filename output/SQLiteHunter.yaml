
name: Generic.Forensic.SQLiteHunter
description: |
    Hunt for SQLite files.
    
    SQLite has become the de-facto standard for storing application data,
    in many types of applications:
    
    - Web Browsers
    - Operating Systems
    - Various applications, such as iMessage, TCC etc
    
    This artifact can hunt for these artifacts in a mostly automated way.
    More info at https://github.com/Velocidex/SQLiteHunter
    
    NOTE: If you want to use this artifact on just a bunch of files already
    collected (for example the files collected using the
    Windows.KapeFiles.Targets artifact) you can use the CustomGlob parameter
    (for example set it to "/tmp/unpacked/**" to consider all files in the
    unpacked directory).
    
    

column_types:
- name: Image
  type: preview_upload

export: |
  LET SPEC <= "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"
  LET Specs <= parse_json(data=gunzip(string=base64decode(string=SPEC)))
  LET CheckHeader(OSPath) = read_file(filename=OSPath, length=12) = "SQLite forma"
  LET Bool(Value) = if(condition=Value, then="Yes", else="No")

  -- In fast mode we check the filename, then the header then run the sqlite precondition
  LET matchFilename(SourceName, OSPath) = OSPath =~ get(item=Specs.sources, field=SourceName).filename
    AND CheckHeader(OSPath=OSPath)
    AND Identify(SourceName= SourceName, OSPath= OSPath)
    AND log(message=format(format="%v matched by filename %v",
            args=[OSPath, get(item=Specs.sources, field=SourceName).filename]))

  -- If the user wanted to also upload the file, do so now
  LET MaybeUpload(OSPath) = if(condition=AlsoUpload, then=upload(file=OSPath)) OR TRUE

  LET Identify(SourceName, OSPath) = SELECT if(
    condition=CheckHeader(OSPath=OSPath),
    then={
      SELECT *
      FROM sqlite(file=OSPath, query=get(item=Specs.sources, field=SourceName).id_query)
    }) AS Hits
  FROM scope()
  WHERE if(condition=Hits[0].Check = get(item=Specs.sources, field=SourceName).id_value,
    then= log(message="%v was identified as %v",
            args=[OSPath, get(item=Specs.sources, field=SourceName).Name]),
    else=log(message="%v was not identified as %v (got %v, wanted %v)",
             args=[OSPath, get(item=Specs.sources, field=SourceName).Name, str(str=Hits),
                   get(item=Specs.sources, field=SourceName).id_value]) AND FALSE)

  LET ApplyFile(SourceName) = SELECT * FROM foreach(row={
     SELECT OSPath FROM AllFiles
     WHERE if(condition=MatchFilename,  then=matchFilename(SourceName=SourceName, OSPath=OSPath),
      else=Identify(SourceName= SourceName, OSPath= OSPath))

  }, query={
     SELECT *, OSPath FROM sqlite(
        file=OSPath, query=get(item=Specs.sources, field=SourceName).SQL)
  })

  -- Filter for matching files without sqlite checks.
  LET FilterFile(SourceName) =
     SELECT OSPath FROM AllFiles
     WHERE if(condition=MatchFilename,
              then=OSPath =~ get(item=Specs.sources, field=SourceName).filename)

  -- Build a regex for all enabled categories.
  LET all_categories = SELECT _value FROM foreach(row=["All","MacOS","Chrome","Browser","Edge","Firefox","InternetExplorer","Windows"]) WHERE get(field=_value)
  LET category_regex <= join(sep="|", array=all_categories._value)
  LET AllGlobs <= filter(list=Specs.globs, condition="x=> x.tags =~ category_regex")
  LET _ <= log(message="Globs for category %v is %v", args=[category_regex, CustomGlob || AllGlobs.glob])
  LET AllFiles <= SELECT OSPath FROM glob(globs=CustomGlob || AllGlobs.glob)
    WHERE NOT IsDir AND MaybeUpload(OSPath=OSPath)

parameters:
- name: MatchFilename
  description: |
    If set we use the filename to detect the type of sqlite file.
    When unset we use heristics (slower)
  type: bool
  default: Y

- name: CustomGlob
  description: Specify this glob to select other files

- name: DateAfter
  description: Timebox output to rows after this time.
  type: timestamp
  default: "1970-01-01T00:00:00Z"

- name: DateBefore
  description: Timebox output to rows after this time.
  type: timestamp
  default: "2100-01-01T00:00:00Z"

- name: FilterRegex
  description: Filter critical rows by this regex
  type: regex
  default: .


- name: All
  description: Select targets with category All
  type: bool
  default: Y


- name: MacOS
  description: Select targets with category MacOS
  type: bool
  default: N


- name: Chrome
  description: Select targets with category Chrome
  type: bool
  default: N


- name: Browser
  description: Select targets with category Browser
  type: bool
  default: N


- name: Edge
  description: Select targets with category Edge
  type: bool
  default: N


- name: Firefox
  description: Select targets with category Firefox
  type: bool
  default: N


- name: InternetExplorer
  description: Select targets with category InternetExplorer
  type: bool
  default: N


- name: Windows
  description: Select targets with category Windows
  type: bool
  default: N


- name: SQLITE_ALWAYS_MAKE_TEMPFILE
  type: bool
  default: Y

- name: AlsoUpload
  description: If specified we also upload the identified file.
  type: bool

sources:
- name: AllFiles
  query: |
    SELECT * FROM AllFiles


- name: iMessage_Profiles
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="iMessage_Profiles")
    SELECT timestamp(epoch=date / 1000000000 + 978307200) AS Timestamp, *
    FROM Rows
    WHERE Timestamp > DateAfter AND Timestamp < DateBefore
      AND (MessageText, RoomName) =~ FilterRegex
    


- name: Chromium Browser Autofill_Profiles
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Autofill_Profiles")
    SELECT GUID,
      timestamp(epoch= date_modified) AS DateModified,
      timestamp(epoch= use_date) AS UseDate,
      FirstName, MiddleName, LastName, EmailAddress,
      PhoneNumber, CompanyName, StreetAddress,
      City, State, ZipCode, UseCount, OSPath
    FROM Rows
    WHERE UseDate > DateAfter AND UseDate < DateBefore
      AND (FirstName, MiddleName, LastName, EmailAddress, CompanyName, StreetAddress) =~ FilterRegex
    


- name: Chromium Browser Autofill_Masked Credit Cards
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Autofill_Masked Credit Cards")
    SELECT * FROM Rows


- name: Chromium Browser Bookmarks
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Chromium Browser Bookmarks")
    -- Recursive function to report the details of a folder
    LET ReportFolder(Data, BaseName) = SELECT * FROM chain(a={
      -- First row emit the data about the actual folder
      SELECT BaseName + " | " + Data.name AS Name,
             timestamp(winfiletime=int(int=Data.date_added) * 10) AS DateAdded,
             timestamp(winfiletime=int(int=Data.date_last_used) * 10) AS DateLastUsed,
             Data.type AS Type,
             Data.url || ""  AS URL
      FROM scope()
    },
    b={
       -- If this folder has children recurse into it
       SELECT * FROM foreach(row={
          SELECT _value FROM items(item=Data.children)
       },  query={
          SELECT * FROM ReportFolder(Data=_value, BaseName=BaseName + " | " + Data.name)
       })
    })
    
    LET MatchingFiles = SELECT OSPath, parse_json(data=read_file(filename=OSPath)) AS Data
    FROM Rows
    
    SELECT * FROM foreach(row=MatchingFiles, query={
      SELECT * FROM chain(
      a={
        SELECT OSPath, *, "bookmark_bar" AS Type
        FROM ReportFolder(Data=Data.roots.bookmark_bar, BaseName="")
      },
      b={
        SELECT OSPath, *, "other" AS Type
        FROM ReportFolder(Data=Data.roots.other, BaseName="")
      },
      c={
        SELECT OSPath, *, "synced" AS Type
        FROM ReportFolder(Data=Data.roots.synced, BaseName="")
      })
    })
    


- name: Chromium Browser_Cookies
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser_Cookies")
    SELECT timestamp(winfiletime=(creation_utc * 10) || 0) AS CreationUTC,
           timestamp(winfiletime=(expires_utc * 10) || 0) AS ExpiresUTC,
           timestamp(winfiletime=(last_access_utc * 10) || 0) AS LastAccessUTC,
           HostKey, Name, Path,
           Bool(Value=is_secure) AS IsSecure,
           Bool(Value=is_httponly) AS IsHttpOnly,
           Bool(Value=has_expires) AS HasExpiration,
           Bool(Value=is_persistent) AS IsPersistent,
           Priority, SourcePort, OSPath
    FROM Rows
    WHERE LastAccessUTC > DateAfter AND LastAccessUTC < DateBefore
      AND (Name, Path) =~ FilterRegex
    


- name: Chromium Browser Extensions
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Chromium Browser Extensions")
    -- Resolve the message string against the Locale dict
    LET ResolveName(Message, Locale) = get(item=Locale,
          field=lowcase(string=parse_string_with_regex(regex="^__MSG_(.+)__$", string=Message).g1),
          default=Message).message || Message
    
    -- Read the manifest files
    LET ManifestData = SELECT OSPath, parse_json(data=read_file(filename=OSPath)) AS Manifest
    FROM Rows
    
    -- Find the Locale file to help with.
    LET LocaleData = SELECT *, if(condition=Manifest.default_locale, else=dict(),
         then=parse_json(data=read_file(
            filename=OSPath.Dirname + "_locales" + Manifest.default_locale + "messages.json"))) AS Locale
    FROM ManifestData
    
    LET GetIcon(Manifest) = Manifest.icons.`128` || Manifest.icons.`64` || Manifest.icons.`32` || Manifest.icons.`16`
    
    SELECT OSPath, Manifest.author.email AS Email,
      ResolveName(Message = Manifest.name, Locale=Locale) AS name,
      ResolveName(Message = Manifest.description, Locale=Locale) AS description,
      Manifest.oauth2.scopes as Scopes,
      Manifest.permissions as Permissions,
      Manifest.key as Key, if(condition=GetIcon(Manifest=Manifest),
                then=upload(file=OSPath.Dirname + GetIcon(Manifest=Manifest))) AS Image,
      Manifest AS _Manifest
    FROM LocaleData
    WHERE (name, description) =~ FilterRegex
    


- name: Chromium Browser Favicons
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Favicons")
    SELECT ID, IconID,
      timestamp(winfiletime= (LastUpdated * 10) || 0) AS LastUpdated,
      PageURL, FaviconURL,
      upload(accessor="data",
         file=_image,
         name=format(format="Image%v.png", args=ID)) AS Image,
      OSPath as _OSPath
    FROM Rows
    WHERE LastUpdated > DateAfter AND LastUpdated < DateBefore
    


- name: Chromium Browser History_Visits
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser History_Visits")
    SELECT ID,
       timestamp(winfiletime=(visit_time * 10) || 0) AS VisitTime,
       timestamp(winfiletime=(last_visit_time * 10) || 0) AS LastVisitedTime,
       URLTitle, URL, VisitCount, TypedCount,
       if(condition=hidden =~ '1', then="Yes", else="No") AS Hidden,
       VisitID, FromVisitID,
       visit_duration / 1000000 AS VisitDurationInSeconds,
       OSPath
    FROM Rows
    WHERE VisitTime > DateAfter
      AND VisitTime < DateBefore
      AND (URLTitle, URL) =~ FilterRegex
    


- name: Chromium Browser History_Downloads
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser History_Downloads")
    LET StateLookup <= dict(`0`='In Progress', `1`='Complete', `2`="Cancelled", `3`="Interrupted", `4`="Interrupted")
    LET DangerType <= dict(`0`='Not Dangerous', `1`="Dangerous", `2`='Dangerous URL', `3`='Dangerous Content',
        `4`='Content May Be Malicious', `5`='Uncommon Content', `6`='Dangerous But User Validated',
        `7`='Dangerous Host', `8`='Potentially Unwanted', `9`='Whitelisted by Policy')
    LET InterruptReason <= dict(`0`= 'No Interrupt', `1`= 'File Error', `2`='Access Denied', `3`='Disk Full',
      `5`='Path Too Long',`6`='File Too Large', `7`='Virus', `10`='Temporary Problem', `11`='Blocked',
      `12`='Security Check Failed', `13`='Resume Error', `20`='Network Error', `21`='Operation Timed Out',
      `22`='Connection Lost', `23`='Server Down', `30`='Server Error', `31`='Range Request Error',
      `32`='Server Precondition Error', `33`='Unable to get file', `34`='Server Unauthorized',
      `35`='Server Certificate Problem', `36`='Server Access Forbidden', `37`='Server Unreachable',
      `38`='Content Length Mismatch', `39`='Cross Origin Redirect', `40`='Cancelled', `41`='Browser Shutdown',
      `50`='Browser Crashed')
    
    SELECT ID, GUID, CurrentPath, TargetPath, OriginalMIMEType, ReceivedBytes, TotalBytes,
      timestamp(winfiletime=(start_time * 10) || 0) AS StartTime,
      timestamp(winfiletime=(end_time * 10) || 0) AS EndTime,
      timestamp(winfiletime=(opened * 10) || 0) AS Opened,
      timestamp(winfiletime=(last_access_time * 10) || 0) AS LastAccessTime,
      timestamp(epoch=last_modified) AS LastModified,
      get(item=StateLookup, field=str(str=state), default="Unknown") AS State,
      get(item=DangerType, field=str(str=danger_type), default="Unknown") AS DangerType,
      get(item=InterruptReason, field=str(str=interrupt_reason), default="Unknown") AS InterruptReason,
      ReferrerURL, SiteURL, TabURL, TabReferrerURL, DownloadURL, OSPath
    FROM Rows
    WHERE LastAccessTime > DateAfter AND LastAccessTime < DateBefore
      AND (SiteURL, DownloadURL, TabURL, TabReferrerURL, ReferrerURL, DownloadURL) =~ FilterRegex
    


- name: Chromium Browser History_Keywords
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser History_Keywords")
    SELECT KeywordID, URLID,
       timestamp(winfiletime=(last_visit_time * 10) || 0) AS LastVisitedTime,
       KeywordSearchTerm, Title, URL, OSPath
    FROM Rows
    WHERE LastVisitedTime > DateAfter AND LastVisitedTime < DateBefore
      AND (Title, KeywordSearchTerm, URL) =~ FilterRegex
    


- name: Chromium Browser Media_History
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Media_History")
    SELECT ID, URL, WatchTimeSeconds,
       Bool(Value=has_video) AS HasVideo,
       Bool(Value=has_audio) AS HasAudio,
       timestamp(winfiletime=last_updated_time_s || 0) AS LastUpdated,
       OriginID, OSPath
    FROM Rows
    WHERE LastUpdated > DateAfter AND LastUpdated < DateBefore
      AND URL =~ FilterRegex
    


- name: Chromium Browser Media_Playback Session
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Media_Playback Session")
    SELECT ID,
      timestamp(winfiletime=last_updated_time_s || 0) AS LastUpdated, URL,
      duration_ms / 1000 AS DurationInSeconds,
      position_ms / 1000 AS PositionInSeconds,
      Title, Artist, Album, SourceTitle, OriginID, OSPath
    FROM Rows
    WHERE LastUpdated > DateAfter AND LastUpdated < DateBefore
      AND URL =~ FilterRegex
    


- name: Chromium Browser Network_Predictor
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Network_Predictor")
    SELECT * FROM Rows
    WHERE UserText =~ FilterRegex
    


- name: Chromium Browser Notifications_Site Engagements
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Chromium Browser Notifications_Site Engagements")
    LET JSON = SELECT parse_json(data=read_file(filename=OSPath)) AS Data, OSPath FROM Rows
    
    SELECT * FROM foreach(row={
      SELECT OSPath, Data.profile.content_settings.exceptions AS exceptions FROM JSON
    },  query={
      SELECT _key AS Site,
         timestamp(winfiletime=int(int=_value.last_modified) * 10 || 0) AS LastModified,
         timestamp(winfiletime=int(int=_value.setting.lastEngagementTime) * 10 || 0) AS LastEngagementTime,
         OSPath
      FROM items(item=exceptions.site_engagement)
    })
    


- name: Chromium Browser Notifications_App Banners
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Chromium Browser Notifications_App Banners")
    LET JSON = SELECT parse_json(data=read_file(filename=OSPath)) AS Data, OSPath FROM Rows
    
    SELECT * FROM foreach(row={
      SELECT OSPath, Data.profile.content_settings.exceptions AS exceptions FROM JSON
    },  query={
      SELECT _key AS Site,
         timestamp(winfiletime=int(int=_value.last_modified) * 10 || 0) AS LastModified,
         {
           SELECT _key AS Site,
              timestamp(winfiletime=int(int=_value.couldShowBannerEvents) * 10 || 0) AS CouldShowBannerEvents,
              timestamp(winfiletime=int(int=_value.next_install_text_animation.last_shown) * 10 || 0) AS LastShown
           FROM items(item=_value.setting)
         } AS Setting,
         OSPath
      FROM items(item=exceptions.app_banner)
    })
    


- name: Chromium Browser Notifications_Notification Preferences
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Chromium Browser Notifications_Notification Preferences")
    LET ContentSettings <= array(`0`="Default",`1`="Allow",`2`="Block",`3`="Ask",`4`="Session Only",`5`="Detect Important Content")
    
    LET JSON = SELECT parse_json(data=read_file(filename=OSPath)) AS Data, OSPath FROM Rows
    
    SELECT * FROM foreach(row={
      SELECT OSPath, Data.profile.content_settings.exceptions AS exceptions FROM JSON
    },  query={
      SELECT _key AS Site,
        timestamp(winfiletime=int(int=_value.last_modified) * 10 || 0) AS LastModified,
        ContentSettings[_value.setting] AS Setting,
        OSPath
      FROM items(item=exceptions.notifications)
    })
    


- name: Chromium Browser Notifications_Notification Interactions
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Chromium Browser Notifications_Notification Interactions")
    LET JSON = SELECT parse_json(data=read_file(filename=OSPath)) AS Data, OSPath FROM Rows
    LET S = scope()
    
    SELECT * FROM foreach(row={
      SELECT OSPath, Data.profile.content_settings.exceptions AS exceptions FROM JSON
    },  query={
      SELECT _key AS URL,
        timestamp(winfiletime=int(int=_value.last_modified) * 10 || 0) AS LastModified,
        _value.display_count as DisplayCount,
        _value.click_count as ClickCount,
        OSPath
      FROM items(item=S.notification_interactions || dict())
    })
    


- name: Chromium Browser Shortcuts
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Shortcuts")
    SELECT ID,
      timestamp(winfiletime= (last_access_time * 10) || 0) AS LastAccessTime,
      TextTyped, FillIntoEdit, URL, Contents,
      Description, Type, Keyword, TimesSelectedByUser, OSPath
    FROM Rows
    WHERE LastAccessTime > DateAfter AND LastAccessTime < DateBefore
      AND (Contents, Description) =~ FilterRegex
    


- name: Chromium Sessions_Sessions
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Sessions_Sessions")
    SELECT timestamp(winfiletime=(creation_utc * 10) || 0) AS CreationUTC,
           timestamp(winfiletime=(expires_utc * 10) || 0) AS ExpiresUTC,
           timestamp(winfiletime=(last_access_utc * 10) || 0) AS LastAccessUTC,
           HostKey, Name, Path,
           Bool(Value=is_secure) AS IsSecure,
           Bool(Value=is_httponly) AS IsHttpOnly,
           Bool(Value=has_expires) AS HasExpiration,
           Bool(Value=is_persistent) AS IsPersistent,
           Priority, SourcePort, OSPath
    FROM Rows
    WHERE LastAccessUTC > DateAfter AND LastAccessUTC < DateBefore
      AND (Name, Path) =~ FilterRegex
    


- name: Chromium Browser Top Sites
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Top Sites")
    SELECT * FROM Rows
    WHERE ( URL =~ FilterRegex OR Title =~ FilterRegex )
    


- name: Edge Browser Navigation History_Navigation History
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Edge Browser Navigation History_Navigation History")
    SELECT ID,
       timestamp(epoch=`Last Visited Time`) AS `Last Visited Time`,
       Title, URL, VisitCount, OSPath
    FROM Rows
    WHERE `Last Visited Time` > DateAfter
      AND `Last Visited Time` < DateBefore
      AND (Title, URL) =~ FilterRegex
    


- name: Firefox Places
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Places")
    LET BookmarkTypes <= dict(`1`="URL", `2`="Folder", `3`="Separator")
    SELECT ID, ParentID,
       get(item= BookmarkTypes, field=str(str=type), default="Unknown") AS Type,
       timestamp(epoch=dateAdded) AS DateAdded,
       timestamp(epoch=lastModified) AS LastModified,
       Position, Title, URL, ForeignKey, OSPath
    FROM Rows
    WHERE LastModified > DateAfter AND LastModified < DateBefore
      AND (Title, URL) =~ FilterRegex
    


- name: Firefox Places_Downloads
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Places_Downloads")
    SELECT PlaceID, Content,
       timestamp(epoch=dateAdded) AS DateAdded,
       timestamp(epoch=lastModified) AS LastModified,
       OSPath
    FROM Rows
    WHERE LastModified > DateAfter AND LastModified < DateBefore
      AND Content =~ FilterRegex
    


- name: Firefox Places_History
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Places_History")
    LET VisitType <= dict(`1`='TRANSITION_LINK', `2`='TRANSITION_TYPED', `3`='TRANSITION_BOOKMARK',
      `4`='TRANSITION_EMBED', `5`= 'TRANSITION_REDIRECT_PERMANENT', `6`='TRANSITION_REDIRECT_TEMPORARY',
      `7`='TRANSITION_DOWNLOAD', `8`='TRANSITION_FRAMED_LINK', `9`='TRANSITION_RELOAD')
    
    SELECT VisitID, FromVisitID,
       timestamp(epoch= last_visit_date) AS LastVisitDate,
       VisitCount, URL, Title, Description,
       get(item= VisitType, field=str(str=visit_type), default="Unknown") AS VisitType,
       Bool(Value=hidden) AS Hidden,
       Bool(Value=typed) AS Typed,
       Frecency, PreviewImageURL, OSPath
    FROM Rows
    WHERE LastVisitDate > DateAfter AND LastVisitDate < DateBefore
      AND (Title, URL, Description) =~ FilterRegex
    


- name: Firefox Cookies
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Cookies")
    SELECT ID, Host, Name, Value,
       timestamp(epoch= creationTime) AS CreationTime,
       timestamp(epoch= lastAccessed) AS LastAccessedTime,
       timestamp(epoch= expiry) AS Expiration,
       Bool(Value= isSecure) AS IsSecure,
       Bool(Value= isHttpOnly) AS IsHTTPOnly, OSPath
    FROM Rows
    WHERE LastAccessedTime > DateAfter
      AND LastAccessedTime < DateBefore
      AND ( Name =~ FilterRegex OR Value =~ FilterRegex )
    


- name: Firefox Downloads
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Downloads")
    SELECT ID, Name, MIMEType, Source, Target,
       timestamp(epoch= startTime) AS StartTime,
       timestamp(epoch= endTime) AS EndTime,
       timestamp(epoch= expiry) AS Expiration,
       CurrentBytes, MaxBytes, OSPath
    FROM Rows
    WHERE StartTime > DateAfter
      AND StartTime < DateBefore
      AND Name =~ FilterRegex
    


- name: Firefox Favicons
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Favicons")
    SELECT ID, PageURL, FaviconURL,
       timestamp(epoch= expire_ms) AS Expiration,
       OSPath
    FROM Rows
    


- name: Firefox Form History
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Form History")
    SELECT ID, FieldName, Value, TimesUsed,
       timestamp(epoch= firstUsed) AS FirstUsed,
       timestamp(epoch= lastUsed) AS LastUsed,
       GUID, OSPath
    FROM Rows
    WHERE LastUsed > DateAfter AND LastUsed < DateBefore
      AND ( FieldName =~ FilterRegex OR Value =~ FilterRegex )
    


- name: IE or Edge WebCacheV01_All Data
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="IE or Edge WebCacheV01_All Data")
    LET MatchingFiles = SELECT OSPath FROM Rows
    
    LET Containers(OSPath) = SELECT Table
    FROM parse_ese_catalog(file=OSPath)
    WHERE Table =~ "Container_"
    GROUP BY Table
    
    LET AllHits(OSPath) = SELECT * FROM foreach(row={
        SELECT * FROM Containers(OSPath=OSPath)
    }, query={
       SELECT timestamp(winfiletime=ExpiryTime) AS ExpiryTime,
          timestamp(winfiletime=ModifiedTime) AS ModifiedTime,
          timestamp(winfiletime=AccessedTime) AS AccessedTime, Url, *
       FROM parse_ese(file=OSPath, table=Table)
    })
    
    SELECT * FROM foreach(row=MatchingFiles, query={
      SELECT * FROM AllHits(OSPath=OSPath)
    })
    WHERE AccessedTime > DateAfter AND AccessedTime < DateBefore
      AND Url =~ FilterRegex
    


- name: IE or Edge WebCacheV01_Highlights
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="IE or Edge WebCacheV01_Highlights")
    SELECT * FROM foreach(row=MatchingFiles, query={
      SELECT AccessedTime, ModifiedTime, ExpiryTime, Url
      FROM AllHits(OSPath=OSPath)
    })
    WHERE AccessedTime > DateAfter AND AccessedTime < DateBefore
      AND Url =~ FilterRegex
    


- name: MacOS Applications Cache
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="MacOS Applications Cache")
    SELECT
       time_stamp AS Timestamp,
       OSPath.Base AS Application,
       entry_ID AS EntryID,
       version AS Version,
       hash_value AS Hash,
       storage_policy AS StoragePolicy,
       request_key AS URL,
       plist(file=request_object, accessor="data") AS Request,
       plist(file=response_object, accessor="data") AS Response,
       partition AS Partition,
       OSPath
    FROM Rows
    WHERE Timestamp > DateAfter AND Timestamp < DateBefore
      AND Application =~ FilterRegex
    


- name: MacOS NetworkUsage
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="MacOS NetworkUsage")
    SELECT timestamp(epoch= ZTIMESTAMP + 978307200) AS Timestamp,
      timestamp(epoch= ZFIRSTTIMESTAMP + 978307200) AS FirstTimestamp,
      timestamp(epoch= LIVE_USAGE_TIMESTAMP + 978307200) AS LiveUsageTimestamp,
      ZBUNDLENAME AS BundleID,
      ZPROCNAME AS ProcessName,
      ZWIFIIN AS WifiIn,
      ZWIFIOUT AS WifiOut,
      ZWWANIN AS WanIn,
      ZWWANOUT AS WandOut,
      ZWIREDIN AS WiredIn,
      ZWIREDOUT AS WiredOut,
      ZXIN AS _XIn,
      ZXOUT AS _XOut,
      Z_PK AS LiveUsageTableID
    FROM Rows
    


- name: MacOS Notes
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="MacOS Notes")
    SELECT Key AS _Key,
     OSPath[1] AS User,
     Note,
     Title,
     Snippet,
     NoteID AS _NoteID,
     timestamp(cocoatime=CreatedTS) AS CreatedTime,
     timestamp(cocoatime=LastOpenedDate) AS LastOpenedTime,
     timestamp(cocoatime=DirModificationDate) AS LastDirModifcation,
     Account AS _Account,
     Directory,
     DirectoryID,
     AttachmentName,
     AttachmentSize,
     AttachmentUUID,
     if(condition=AttachmentUUID,
        then=OSPath[:2] + '/Library/Group Containers/group.com.apple.notes/Accounts/LocalAccount/Media/' + AttachmentUUID + '/' + AttachmentName) AS AttachmentLocation,
     AccountName AS _AccountName,
     AccountID AS _AccountID,
     AccountType AS _AccountType,
     gunzip(string=Data) AS Data,
     OSPath
    FROM Rows
    WHERE LastOpenedTime > DateAfter AND LastOpenedTime < DateBefore
      AND ( Title =~ FilterRegex OR Data =~ FilterRegex )
    


- name: Windows Activities Cache_ActivityPackageId
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Windows Activities Cache_ActivityPackageId")
    SELECT format(format="%0X-%0X-%0X-%0X-%0X", args=[
      ActivityId[0:4], ActivityId[4:6], ActivityId[6:8],
      ActivityId[8:10], ActivityId[10:] ]) AS ActivityId,
      Platform, PackageName, ExpirationTime, OSPath
    FROM Rows
    


- name: Windows Activities Cache_Clipboard
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Windows Activities Cache_Clipboard")
    SELECT
      CreatedTime,
      timestamp(epoch=LastModifiedTime) AS LastModifiedTime,
      timestamp(epoch=LastModifiedOnClient) AS LastModifiedOnClient,
      StartTime,
      EndTime,
      Payload,
      OSPath[1] AS User,
      base64decode(string=parse_json_array(data=ClipboardPayload)[0].content) AS ClipboardPayload,
      OSPath AS Path,
      Mtime
    FROM Rows
    WHERE StartTime > DateAfter
      AND StartTime < DateBefore
      AND ClipboardPayload =~ FilterRegex
    


- name: Windows Search Service_SystemIndex_Gthr
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Windows Search Service_SystemIndex_Gthr")
    LET MatchingFiles = SELECT OSPath FROM Rows
    
    LET FormatTimeB(T) = timestamp(winfiletime=parse_binary(
       filename=T, accessor="data", struct="uint64b"))
    
    LET FormatTime(T) = timestamp(winfiletime=parse_binary(
       filename=T, accessor="data", struct="uint64"))
    
    LET FormatSize(T) = parse_binary(
       filename=T, accessor="data", struct="uint64")
    
    SELECT * FROM foreach(row=MatchingFiles, query={
       SELECT ScopeID, DocumentID, SDID,
          FormatTimeB(T=LastModified) AS LastModified,
          FileName
       FROM parse_ese(file=OSPath, table= "SystemIndex_Gthr")
    })
    WHERE LastModified > DateAfter AND LastModified < DateBefore
      AND FileName =~ FilterRegex
    


- name: Windows Search Service_SystemIndex_GthrPth
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Windows Search Service_SystemIndex_GthrPth")
    SELECT * FROM foreach(row=MatchingFiles, query={
       SELECT Scope, Parent, Name
       FROM parse_ese(file=OSPath, table= "SystemIndex_GthrPth")
    })
    WHERE Name =~ FilterRegex
    


- name: Windows Search Service_SystemIndex_PropertyStore
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Windows Search Service_SystemIndex_PropertyStore")
    LET X = scope()
    
    -- The PropertyStore columns look like
    -- <random>-ProperName so we strip the
    -- random part off to display it properly.
    LET FilterDict(Dict) = to_dict(item={
      SELECT split(sep_string="-", string=_key)[1] || _key AS _key, _value
      FROM items(item=Dict)
    })
    
    LET PropStore(OSPath) = SELECT *,
       FormatTime(T=X.System_Search_GatherTime) AS System_Search_GatherTime,
       FormatSize(T=X.System_Size) AS System_Size,
       FormatTime(T=X.System_DateModified) AS System_DateModified,
       FormatTime(T=X.System_DateAccessed) AS System_DateAccessed,
       FormatTime(T=X.System_DateCreated) AS System_DateCreated
    FROM foreach(row={
       SELECT *, FilterDict(Dict=_value) AS _value
       FROM items(item={
         SELECT * FROM parse_ese(file=OSPath, table="SystemIndex_PropertyStore")
      })
    }, column="_value")
    
    SELECT * FROM foreach(row=MatchingFiles, query={
       SELECT *
       FROM PropStore(OSPath=OSPath)
    })
    WHERE System_DateAccessed > DateAfter AND System_DateAccessed < DateBefore
    


- name: Windows Search Service_SystemIndex_PropertyStore_Highlights
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Windows Search Service_SystemIndex_PropertyStore_Highlights")
    SELECT * FROM foreach(row=MatchingFiles, query={
       SELECT WorkID,
          System_Search_GatherTime,
          System_Size,
          System_DateModified,
          System_DateCreated,
          X.System_FileOwner AS System_FileOwner,
          X.System_ItemPathDisplay AS System_ItemPathDisplay,
          X.System_ItemType AS System_ItemType,
          X.System_FileAttributes AS System_FileAttributes,
          X.System_Search_AutoSummary AS System_Search_AutoSummary
       FROM PropStore(OSPath=OSPath)
    })
    WHERE System_DateAccessed > DateAfter AND System_DateAccessed < DateBefore
    


- name: Windows Search Service_BrowsingActivity
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Windows Search Service_BrowsingActivity")
    SELECT * FROM foreach(row=MatchingFiles, query={
       SELECT X.ItemPathDisplay AS ItemPathDisplay,
          X.Activity_ContentUri AS Activity_ContentUri,
          X.Activity_Description AS Activity_Description
       FROM PropStore(OSPath=OSPath)
       WHERE Activity_ContentUri
    })
    


- name: Windows Search Service_UserActivityLogging
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Windows Search Service_UserActivityLogging")
    SELECT * FROM foreach(row=MatchingFiles, query={
       SELECT X.System_ItemPathDisplay AS System_ItemPathDisplay,
           FormatTime(T=X.ActivityHistory_StartTime) AS ActivityHistory_StartTime,
           FormatTime(T=X.ActivityHistory_EndTime) AS ActivityHistory_EndTime,
           X.ActivityHistory_AppId AS ActivityHistory_AppId
       FROM PropStore(OSPath=OSPath)
       WHERE ActivityHistory_AppId
    })
    WHERE ActivityHistory_StartTime > DateAfter
      AND ActivityHistory_StartTime < DateBefore
    



