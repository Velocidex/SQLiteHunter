
name: Generic.Forensic.SQLiteHunter
description: |
    Hunt for SQLite files.
    
    SQLite has become the de-facto standard for storing application data,
    in many types of applications:
    
    - Web Browsers
    - Operating Systems
    - Various applications, such as iMessage, TCC etc
    
    This artifact can hunt for these artifacts in a mostly automated way.
    More info at https://github.com/Velocidex/SQLiteHunter
    
    NOTE: If you want to use this artifact on just a bunch of files already
    collected (for example the files collected using the
    Windows.KapeFiles.Targets artifact) you can use the CustomGlob parameter
    (for example set it to "/tmp/unpacked/**" to consider all files in the
    unpacked directory).
    
    

column_types:
- name: Image
  type: preview_upload

export: |
  LET SPEC <= "H4sIAAAAAAAA/+x9a3MaubboX1FR95TtDMGxk3ns3OIDATxhjx9cg5NMhrltuVsGbTcttiTiMHtyfvspPVvqVgOOAafmzFSNQ0traS2tl97Sf2rjlNyw2uvf1K/a69rhFUOUHT47PMU3FNLF4RliDI4RO4wnkDeSm1q9xuFY4NTOYHwxqNVrrTSt/V6vZXCKaq9rBu5LPS90Qqbo8NlhIybZLR4fjgkZp+h5PKEq/T26AR3IoVN2W+bV6rU3lNwzREtkLM4SOorAc4qmhKPnCWJ3nMxM6oySW5xunTyeT79skEb79WgkVTQaPRuNWrOZABiN/nNJ4BRn4/opiWH65fANhZ/QgNzye0iR+nomVSsL3D0/P0uNHyoST8nIGY4pYeSWH3aT8VNyMhpdzBCFwCjJfnN4k6LRaJN2WfTp1myW4hhyTDIwmM9mhPKwxeyaCd9Mdk3d2gaQtrHFyFAMgG8IuZtCesceQihHenwI3DIDOghujsqmwuDOOaoOhDtnZUko3DUvawTDDVroY8LhjtkoBcQd0y+HxO1FimJQbBNyh9GD6BiUxwfELRLXwXAzFDYVCHfKTXUQ3CkbSwLgLvlYI/htyBofE/h2yEIp6O2QdjngbScSFINd9zNHGcMkY4fPnh1OYYZvEeONfzGSPYSyj/j4MPgkbOkAuW3amwqd3wif1UH1G2FwSbj9NjhcIxBv3R8eE6K/CeZKwfub4Koc1ncd2YoB/wR+wjHJHtSuWJzHB/atktcBfFM0NhWod8xPdUDeMSNLAu9uOVkjwG7MLh8TSHfKRClg7pR6OTBuKzIUA+BbzDihi4eQMSiPD39bJK6D32YobCr07ZSb6sC3UzaWhL1d8rFG0NuQNT4m5O2QhVLA2yHtcrjbTiQoBrszlGAIvoKWj/j4wLcjRnQQ3Dy1TQXEJ+OsOjg+GUtLAuVT8bRG0NyCJT8mgD4RO6Vg+kR8lAPr9iNNMcieI35P6B1oxZK1PkUJjjmhDyFeWcbjQ++TsqcD8q542FSY/sb4rQ7e3xijS0L6t8XpGoF+Z37zmPD/TTFZahS+Ke7KTcVTRcZiA9Kn6BZRlMXh5T7B7hIOXOzHtxa740U3DVshuKl24CmZqw76T8nVkgj/hGytEc63Y9iPid1Px1EpUD8dK+WovJMIVAzBgwmhPJ7zB00/50iPj7tbZkAH281R2VSE3TlH1WF156wsiaW75mWNALpBC31M1NwxG6VQuWP65fi4vUhRCoqIqZ0K+kf07EEkFdImYuNO+DAhctPENhYpn4ixJQHziThaFjefhqV1wufGjfhRUfRJuCkH0ydhIxBTtx1hiqF1SGZggPnD9vfmSI+PqVtmQAfTzVHZVBTdOUfV4XPnrCyJm7vmZY2AuUELfUyk3DEbpRC5Y/rl2Pjt+fB7dNNiDDMuvm8gQw5nK6YHyqgbPlT+lIwtP2T+hJytd+h8Kww+9hD60zEVOpT+dNwED6k/qUmdkT9wmsLR6ARTdEs+j0Z91bsRVZmlMEaswf6dYu4ypmGX8OZjhvo5U0X48FaVdfiskaBbOE/5VsmyDM4syZhMpyTbOSvrGIou/zBXxlZ52oi1xOrg3NcwVkB9oL1slfBDLWY7zDzWZrbC1UasJiH3WUpg8lW8lZAfaDlbJ/5Q69keQ4+1oK1xthErutVnGL6GuSLuA21oy6QfakHbYuex9rMlvjZjPYROJ2rL4lexV0Z/qA3tgoEHW9JWmXq0PW2Tu/Zry582qUNpSM7g8D3OEnLPRAe+DeMJsj/evThqJJCX+/G9jCOaId79PEsJlTwt6dp7ZS0TnAQUCfLHOpf8WUC32BnFnyBHh58gPczUdqxE/JgzOEZlCYdLLsKvJJDcbJRGSTYk4xBnIjEm0waczVLUOCccsUOlVA2nkuTfd88awipQ4t8cFuZFYAwEtGbmT1VE47u8iGXs/UzJfAYcJscioZGzmlm+XCqbZsvVzIwSjmKOksPP+ufhh/4aNiWB1vGgNskySaCDPuEYsX4KuXDGw9PGs8NWzPEnzDFiAWPWHlciHUAqNBB9SsYUTlXTYF14NBogSOPJaKQynAjERiNNzf5ooLWYcaG//F6vMTKnMWK11/+pYX0bZ2TCmUg8V2jlvHrt3f87rb2uDbqn3fYQcDxFjMPpbB/NSDxpJpAjcAiOXpj/wHfgHz/+9PLFj8cvXhyA1gAMDUYdPBtlJ5cXZ+BSVCh7/7Z72c2zwWj+4sVLBDqQo9YtRxS0zjvF7Fhmv0G3hKJRBiTIvuZ5iD7zOrgkZCoqcwCa/w1OcMoRvURj9HmU1eq1gVMVgT5tUHKPk7r4HROYIhaj/WkjFvqLKCFTIU1WB5MGTlRlJhTBpKcwpg3MoltKptEUicweO6Fkeobqo0xkt1uDLrifoMwHbIIjMHzbPQfTBoxjMs+4AO6eDrqSjPw474jyRGn9CcnQ+Xx6g+iqYl9UFWtrNjlu4ETXxqEzJGUq0wZDVDiGABion7rSQuX6J0efuQBwNSBl2Ugwm6VwEQkBCgijFm0BU4UAIANTgZCiWw7+RXAGJjBLUpkxAUTUUSVEOAFNMFH68jHiCeQCPlbwBeWBJogb4kux8vw5EMHstcRy0jET6WCe4X/PUR3wCWZgChcghnOGAMnQc06eT2G2kDTLDESaTZkgmJHcx4pfwcOkIcGKzDvVPZYYE7/Cx6bG0lsELhB14HQBOAEoxVOcCRdM5ipoIAaSORJ5Gcmeq+pYLC31oogOfVkocGEsxgSEcOZpCgh17EIypz8OhNFcXHa6l+DNr9pEQKc7aP9f6XY4if49R3SRhxFpoPvPpE9dtycovrvWlqFaimgKGUfUBAm+mKHmnpxf3pPsSb8XzDb3itLfAxeXQGXp+kaQcxhPpijjCkLVUPxnQdkii6MEpYijJNJ4bO/A8v8JpnNUe/2yXhNh0UxJ2FuK1RoKnk+B7kqB1pyLCJqGouwawIWw+/NVryM9qxh/gRB1NCUJvsVIxSgRIc90QhhnzlAk8CT4FUMd49EnmDIumKyDM5wkKVK/T6FJ7U4hTltJQhFjEsONHKBNpjOYLRTogFOEuAvbxnwh0gU18BHP2iRBdUG/LayhDi4GfcgngTZCsxhuIbzMYPvwsFotqcVabQo0utTL86wxnuNESNoq0dOZTDEaqYdKkF7JGreiGjag5pVagjKV1bU4Tu2XIKXQIWOFFERAQnCsIf8RMaxkHiWMmbAX1sikxQgCftMTEl+s9GFZcvUTxmBSaRFUjMgWrGSMATqYL2T5wkyrChaWJsurUhZr/IFnMUkkmDHyMKBQugyE2g3bqtUW5h9EEIm98/PuJfjnRe+8ShvgojJLWWKzwkRXFa9UFyq+smCj7nWKV611iHmnkBANZbWKhGmDljpie/uNkqHtNEYxRQnmUQxpwkItELm9RVQEAeggifYVUWPJiDlZd2hxT0RZpUbqe6+Rcq6SXtLwnEF2hxLQlkyCtmByrQYrhFdou54BG9BDXXBZQORKp6HCpQ6WIQBRtYhk8kuACjYvMkG9GsUc7RpILvVJr0pwGQRvyZyaIHhC5rQSGn2eRVOS8YmA7n6enYnfS6EXCFIN/CuC1SXfwOzORr43MLuzYS9YSRzf2TApaqm/KxHE3wgzNlfBWOD05FclBs4Yp3PZl9Jqsgm9jundl/Hc7mGVxv/2S+tf+V3HS5zQvUVZedzz5+ASxXPK8CcEbueZOsbICaBoRigHfIJAgrhsJsgtgOCWpImQ3Gl3CC4lzIlM2Rec1cEbyJAeTAPfm+MJxNk+bP5HSOz5c9UdAZTcAzTFmhDkEMAbMlefMOZzmFqKwBRoaIDvwKgG/hR/vpOCaRhLtiav/8v7s/c4ExIVCU2c8X2c8aZElT0smCSiS/wMHL2wHeOWSPuawmRAmLNSgSI2XDG/TIklzFCOrhczVMqc0xT8Keo6qgHZ+l+eyv63NOqYzND+wSj7Uh9lN0rCQsS9WzUsVRIEEznKxGlCUQao1DoCOOMEYDn0LyhM9IhhPNmn5F4XmYMoA1VwmKMp2xd/VeUNCTlhAL7UAZDeWSrDRPmiETVV4bktNZcrXNMR1ZejSmGZZ5DHE5yNT0QrnpuiGi/UwQxShqJ/MZLtC5trUgSTSKhy37hbU4EeGK1Bb5AxyqpF5ZGuu3UP+YPsdhjRFLh8Vgej2o122egG0lHNmIeCr5CflAwlhLOGi+0IVFiRFNsXaWc3yxggfIK+grJEqyYZLyMphtYoeThNhRckqq3Ddif8ZsMLutk8Tb24614jX4qpkbl1uTrsRvldzhUzo24g2Y8pklO50ZzHOnL8+SdQ8aOt866G7TxCVJSDPs8wRSxUTFdlrVOKjGIwjhELliSCWUvmeoW9JYz/ghZ1FYmB1K3NfENIuv9OCLuJWcREIFITCz02kB9VoBPOZyRLFxr4LeeziyxdBMEnkEVaAhL8LWSy1lJ8VQRmiDLMOMq4JtG3CTlKn2JC1cSEnCLvE7psKsKTUHhCIgASnJbIhbnWvILZ/+IaVN3NcCzESy/o3MubEMajOyTHvUbLbn6pCTYZM6g6u9YWTIa1gWKqUbdPP9drEX7mK8sS1vqSxI3uXAC10hHJ/o4YqVutam1qOKdDGpLs47ujoNwb9aYtFVFvtpLDcqfx2Ate+aXw5e5gfhnxsk6jA+X1GhlJPyHZUTNz84xTnI0BHEPR55dZcukMgQTH3PQZJZ4gZpZh6hpK9BnHiKuuhEqyXneLUZo0U3IfQ4b2FaGmasbVR3SP+SSiwhn25d/mqPb/o+hs8HO03/juIIr+z6hW1xw2NeGDxvjowJLQC/R5pqnWn3+a5QrR8su6w0RVXF/DDPRsi+p6qDTRLj2652EKK/Q+ZPc5S1wJC3TRb5+gdAaELBqKHZXtM/OsDvDtfkyyBAvrbRoqZo9ClCrhA5Qy1BS627di4hOUNatrkXdbC/VpdDDNTB9OE2CyI1dBXQKaeXV5z/WodqCkouqkZeLK23T/fka8F5Ns3+QJy7Jk1Iac66Pjn66lagvpP7wKJr88DiYf/XDtdAeNli0UnPMJoXq6UzS84ocUZcAPXCYzNeEsK9o07tEaADs2X4GfIBZTPJONXaAYN1uUZvGI4Pi4IUcUDEAGBvKXDzRDdIrViTkB0s8/fTjRTEAGZEfAM7iifqwFHrjjHmNt81lKYCIdpGxM1UUpW+lNRYRx2RKpUcGxci8xzfa+0oAjqCVt7kN6k8Wr28sB115rvCQoO9cle33KXqcOhDxKiz9upw7syzHoTAxTk1CPTmep9Ro4RleXp3VDUvyWCxBKK6qbQGhzVBOhYFQzGpTqirAVPwCq1boldAr5vvqnOapJBf3Xp8YsG4sIDemYNXudovKU3oU1RUt7WqZSlf0sD8DvZQW6UHb/njfBqFOjG8yncMZkLDBzW7nsS1CiMpGa42DAkUwRUE0caD4DGpHAUzib4WzcmIlC5zRVXSulKo9znZdrT0vOAIwyZ47dLdrLKPAoVeKDWyk0q+Rj+rGuUJcA296Wr4Qtzfk5HS23Vk5vy7BRTjK8r1r9de4rL3u0vnkyeocZ5kt9vwBZjgDS3SrGc58EUiR+Fx1fFjfEZuZs2XiwuhBhq7IglORFXV2eDjEXHQoZSGS+XsEVw/tE/ZagXjMxwUmCMhF294726qoxGNV+Ff0G3TcZ1c7JqKYGeBJYlSIpiFB4QsnUfMgcxXkyV+PAfB+SFUBHZ/WyARKcqCatenhnpVYKOcaqChDBkZ0nobUGd3OaFqKSrBprOLqBDORfdYtVVCFkoJCUw3LBlZ5vVBzaLB1YbHsg0lQRdonS0XReotB4DlIwAAmi9Q4ZmORK1dVTVXZ1qjPktib52+yECgAV1G8FZFK0ggUXoid5MlTRT2GLiGfE3jQlzmnqhKqyDnYRsARTTlRSTDgJ9hCDtx4xnqKMB2LWKy9m5RfiVgeijil/naiVA5vAJXrscnn8lJC7udm315SDxv3rF9fNvV4G5E5IxNheHVwfXTf32mQ6SxFH4vv4ujmqtWEWozRFiQgO1y9Fkty3TOczrhNflRIP1HihA7MxosIUA8TPCdcAZG7Ij2o2RZZ8fN3csynCJfYUD05im2QcZXxPd4YEM3s6DZzBBXiDwBlMcYw1le+vm3tXmdrtniOD6x+8Ut/MOZAHfd/BFMsugiXwowf4ljCJ/tN1c69PRGEYpukCXGX3MJNo4Pof18299xPMUYqZ6HvcLECfpDhe7Gk5WdldIshIVhYW2DsnOZQWFtg7EYPTLqWEanXtqeku0EEZVrSlsDC7AyfzNFV1kCKQ3b4hIeCUZOO9uqy+LE6mQTqWFiDq+g5TrR+htSGazgiFdCEs5yZFU5kjLOdNSuI7I6frI8GNnHbEfAGkG4ITiFPF1ZFg6xKx+dTlX1qFXh3OU0XZ8lyzDC0i4CfgYq4Vfn18rPSdIbXEdqr1cfxS0qefEAXCNaQsXuRptvyXovxLoU9wif49FwMZnSfLf3mc4/Qpso2oU8BLaVEigABOwBipaQuZ9SpHvsrUoBX/YWX08vs8u40ox7dy46Ar2Zc/5CBatyeE3sjwLfN/dCnI1RIZyTSBnxxnOEXZmE/AGWZTyOOJxBaW2aaEMXBB8Rhn4BIlmKJYivCVEJd1f5ki9awDz2Ay54mUrDKqF05em0I2QcnegTOIF/0GufEKtOeUooyrMf1Q2Jr+rZiA6VnvrCtX68AlihH+hJI3C45YHQwJh6n6XT0M22cc0nA3aiBybAeqaoI/S4LI3SxZhUpmKCsP/S5k6jI8d2a4qvun1B/gQO0llEV42w8Fkrf90E4COq1CXU8BMk73GadNubHqoG5n7Ua1q+wuI/eZ7g7m+61saXmULxaWyJxINLFLinTwvXILUbFYODbZEZX5SygUS1ITPbeIUkRl13mAuRqMD+GN+dcDMK2r/FhjTSLYcy0sSqzou1qePNpVDFZxu1anNz+N6fV88+TyxkmbFStnjsw6hOvcPiSXnm4BHcf34YiOAtEUT1FkVu9LscFHojpQRDciOsiN7l7oKLAi4kgOWggrzuFUG0kKGSZGFFnPPT1PLDp3KNvbg+rR50V4x6kKOUWPKIlImYgSTm4uBZKii6zHIMYEi3q8MQDaGsv5hpYDWCTpGKkZ8zhJ2rtsqd6siU0VxUdyxZ8V8MWgwjPrpkfQmwgpmP9ff2Dxi94Ztc64wsIW5kN0umjPry5PV8yOfM3shiagjmQNEZ3WgTvbsTQIO4VVR+ESUDAMa5oBbtaNrnofWsQkbsQRnbKGSVRxNRdmJYKwdAWcizs07VBdgvjrEHOqUp6WqJyT0AIPEfBcVKAJH1xWl6YZ9ju+uFpYf133lE/lRAZiiW/6gIGlCukh70U3X1i3N+NW2MvxCSeImJ0c78RHEAzOE2zBWuJjmb+7M+3SKCNWvRCiW3bB9taWIJR6RbOwhr/OUri4gfGd3xmyqYX5OZt+L8RtatsahMVvoa3sy8nQitcmBwTqA6g+kw4QRqBakAbI8TK/itv3KMWe4y6GgUCSvvZz1aR/8V2pKi/p62KBuU50pV+VMMIrAY80fWtAZo40mjI9by67MsH58hlhuAzb16k+rG64WpRjxuugld7Mp2Zvlc77Vj1PCz7sgCZzlU8YuAp/NdmO+IP5jsiD+YEmswgCpQoEjFZGEEjoR8JIRYVA9IYqS9HVZQh+naCgYQOxIVfCXzM86JnGKH9baElkKANXn61xDkvSIfrM17F8oE/FRFBOY0YzQ8f3gWqwORNjQn0K3FBeheN7RjWgOiQYkdtogrls3NQ5wYvbt5iztZGnmDHkoZ/JFG01VSXUAUVmL6EYV4pm1mZGcuMk1dOWjhkvF+j2m7y1ec6Pulhbr+LdcYdlxU8Rh/KYzAofWfLIVsADiJ6fxiRj0QBzBLrZGI6R7PYu9Z3lmO5y1T8HF+f5frqvOE5gWjKw5qkC9wCB2WUmd77ro4qNWM2eRwxxjrMxa6DPMZL7lqQhO1+ybFGBUVY4nGEOd+jtvUICdtvf0kMvSm2NwtSuGDz7fQpvlnfdUnWNZOm5PkSHNUTChzCETLcBlI6s5IJRM0rI4j/myID/DNEqU2vNZuANzDJEH2CfLtLfprlx07SnlZaRXp9+TOZpMpiQe6Wy7icRUop8tENAD6eVoc88whnjME1lUxvBDE+l2Sg5sAm5z0JCELQzS6/oKr4/Hmi4L1IoKu1B7gZns+hGVnR3nuZ+ARd1bberLMH1Qb2UqaXC7Do5pBQu5EL5qNZRa0CjWl1tKGilKbkXX3I3g1ykFl9yI0OLyd9y/4LuV4KLLF2IxO9VYRzFHPSmM0I5zLjhQO5wUGv3/9viwlbCQkGxv/ku8XvZFdbyhMy1sCdyBrn0qPpxX+sNXhFbb5LkriHQzA+/fmu2aIcr2zFFjWauzVIb6iADHZXg7Kk0oHGK47scsC0+XbBqWx14JhphR9GCR3VCZJuGm79ftsQ03ZfR1p8IA1+zqUEMWuXOxboYMae9jJNugrme0NZRQjXdHfckhtp8oBc26uquugFK5bWCbxZiOLyrVXvLo8vgWstEZJrh6IZ8Ft0IJe/wynEAzoz7c/FVAMqbQnDGSSRvCZG3FzlirsAqzBMEILSbM9XbcrQUgHWOfsg4VDgyE6pe8QB/AEYvETnrW1WQ5cmMkLlUIJvZGG1GZQhnBmINhe5kJkIeZ3Su0Sixteqso/vKYR4ezONekfkRiiFloL8Pa/99WPvvw9p/H9be5WHt/CXBcu8mf1JrSRfIfaxr1bT/fmC1S7Ar12mK6QdBo+VkFjFBTu6UoDC70+3vJczUTVkehNs45xn+wpSWtc12FBmktvNmyXKxSpnuG2jyJvV8DAU/4bEaM5ndS+UkR81fgbzyUJjajHstohnQG4xk/+JaSaycrgqoOsdVGVEDJVWelKqEXbbhad3dTZkVUmSuz/eWrAL5+Y4lvXIrwPdKTO5V4QeWXANQBccIQGRzfbKJ+Yeq8psfy0j+zYZrVm5bt+8KfekVoxIje0UvOipeelZ6K8y8kgD68lkox1MKGe4khLnFR3TOWeHkipyAu7o8NWd5RjV1w1B+lGiAZpBCTqicUXN2MPUhlRfZKfewe8J9csUt4Ss2mucXgIUuT2+pS8rK15OFdtqfLd1ob3dk+FsWTwhFeJzJPuHSrpIprLqn5ENswo/tbUy+++bJM6kR1XtxdJMD2B3JeVLiSTJPT4sSc8ho0bkbW4qEyv4/JX9E+jGzgt/naLeyFc2VYO5IJH9E5j4vGQgshntUMScALs79QpsudW8zY0GmO7hWUXCiA0Bp26JX0dAFi3k1Clg4m825iSsrNjgWn5QrxI7gocZKkEJzK/PlCSI1x7AbZ966q5oTWuu8k0D+iGCWEdaQctZ7e4xcfAg9KePMyaj9Zp5A3Po7DiFLMPUUHxHknOKbOZc0e+dg/6h+fOBeJmrpWgJ/m7yy53LPswLAbVfV8fby0dmj6+be8LJ1PugNexfn0Wnv/Bdz+NNJHv7a73bM+U8n/c3FxS9nrctf9KG9V35u9+yNwvr+ugncjMtup3fZbQ+jfvfyrHXePR+aI7MhoGH3rH9x2br8VVP50YfrXLw/P71odcyxWSfr5LJ11u3YSv2jSECiuWsS1TcSlO7ad/bJ2yv37TEAe/G+1/tWJ61UO1qcp3T6JFZVxf6I3pW/vFeSY4+KG6/lMc/SLQwOhDz0b/s2Ol6dUBSjLF7UQZ+iTxjdy+te1jw0UX29fwBkRb/j4XPgJV8O3EtQhll+RYHTOBdMoJi9/JaF6i6Gk7O8a7Ji6rtcs9yAikU5Nzi45K0VOIm32h6UcLRtFGBmylLU7Tn23hvffJzmQWF5Bz5KzIt+kkMh34zaDKq50JSENfa/vkUp34pazAmcBnlLGDez0DJuVERIM5On9oA5M+2h22ucqKqmbZ3+k0lYgienLxf5RLwzJe3EN4D1bHhgatwHM/PgZlp8OOzLafF15qQrDoqZiBYGDMY+KeTA3J9kc725P2Eqdj7Xu37fyZgQtZ9caraYWZp9djPVBdMiullDcLPjosbdTFfXpUyl0FIydnXmZxiVOXGlPMtcEscOJiZzkmU/9WdRSk8hW3dcNsypHN8IZ9XP49gbENRMvLknocKbmLnXIHDLQcD31EUGpUsNHuSl+py3vpjhDH7Wvyr9zXJV6WgFiJCHBfwrvJ9eKLHiWHshr3y5vZ8/xVM01CvQ3uHzApxaQckXT0Iw6gg8sKffFQzz9YVclfj48ZzSN+bUuqeBEONaJ5Jx/dvxNedotedtOz8N7RFd5XGBh6OtXwUueCxlBTyu6ibGCndA0ZQFPSJg+RXxPXD3oew2wDFi0b3OrrqB0CkgJllUuoewAGR5dlRfvqDQpkacKD5M9825UrAMlN8qWCjLq4pXVI4rK2gL9itf6g8WKrO7jmDxbsJyRQqZXkVWHcEoP2Sdmyyh08CiVTA7YNUnYiTq9vnUNpf8hYySdctnza5MP+7EfC3p+F25nb4cVt3ys/xIIVt6npAtndnO6/a4rpZ/+agoM3/TzQhPZAX6TNzI0u4fstW/9QSXupJxr1Fx3NF5etqx+l1OGTscrArAwXeya70uIBTIBVXnqeqolabqaZ3cfldBunNgS58b8fdLm+3h6t3kfb3TNccZirqbs49ypyxiKIohhykZu3cgH9j3cOWNXs3/BqOaLTga1UbZz5cXV32hIV2mIt5K07eYByhXP/viA5S4zxn64r13ApZunZKt0iLv39lPu3knjGcmgS2mm7AC1x0dSVxvAAiuaCqfHDZnH6z8XbnXgTTPphSqfXTm8e/B+HpxZGoVvXQQKD1lvdHfFU03c5V1+bH3Kq95i8eTFI8n3gbe1bDhTSwPkq6vYc9WXJsTQhmZnc9/DVXI586B+zY4kCCOBipBfMHbhjVSD2t7b3Q7XcrGG8hk++OUaIYKnC6iXkeN5Dhd2Pt4EWV6lvGd+qnSJ5BNItuevYVsYoYghIru2EzeS6kGkTJFXVSpgKi6H7G0EX+WYsaVLxsQcvMvFPM6KF1jLsODvmgxgM1mJGNoJboC0/iQ8nzF2HysWLp7/GPnji5WDUhBfCvvqVKPPWvmG67uzO98g6VWYN3RWL2gpbqrEH8Pa6TfebeyyWGNaAuyNtv8Apx6nXsX4CYlN+ri9YvzFXVshhEtQCUNfa8b/So6HrJDa+svYQd4dB86DIkiNJdcWZdVwwoZbfSD2CoY6bPeVwyOy5HKy6zcoK07/h+HvbPuYNg664PvwD9+/Onlix+PX6iN0H70KmOe9C4Hw2p0OeRYUcZp7103uhq0fu5G1QWd4k9IVsYv7OObq/POafe8ddaV+zzmWZKaZfOP/cuLtsnpUyLijh0AfHzfO+n1zkXWe3yLe1meenE1NMkXc67T37fONTTMLPD71rkBhlmSA/cuux1TNkVJXvhlt2NLpyjH+KCgow8G9IMGiz5YmKj/iy8IYad20FE5OSGl0B0MGrmS6366r0KVKXQiVeKgSeoBXemHLBxV+OJ35e1J2RWtJ1FPjL7srLxyOZU4jvq/1LVY8mR354+puwg+uRyEgJteQW9bA527/QCT03XCimFu1QbaDPG5sAln+KbDAPG3Qbup5dv/pMXpne+qnf3tSJ7UNOdnBKL41y6FDjI8m6lJT5Gnmr5I/RSJubPHJCZQDi3kEhRKhoN8QSofkoQQTiHj6sLdjrvKr5KWIXYwVd1Y1ah72CYv73u1YrtOHOnfIrkjr/QgaiHEfqjqtTiH8WSKMvuOe54ywH8UUq70Vaveyw3lbPOYj9bA6+PfwXdg7/AU31BIF4c/UzKfOUPLw7FIaMRk2oCzWYoamdDuoa4BO5QP9uivQ3mHzuEe+K7AlqTgJ6u3aUUX1SaJogrSOtfTK5Hz7WRrg7BfTpaZgI+cb5E9nmd/4Jl5uKwDOcwPt1q7rJiDyk2ieiaqCBOejwpu7b+4BOp5sFVTUSBrmHhtDpJkjY/nF8MugMx6EYiPRHgdnnaPRHK+v0CkD857/X53KB+Wyp1MZvU63fNh76TXvTSlacMRme3LbmvYuzjvtIbdl0CeXjX+ZmFOLk473cuzi07vpNe20FLKZY+xWKetwfCi3z3vdgy075gK8LjxsdVuX1ydD18K4o4jyTxZ3WN1+tbxK5nn16vgaiB+JZoq3daLkku+B+KXCmTQ+1gAMc4oS/HpBBww/r7x0ZLx7VrmFQpwjVvmawEMf+27RdhVpqzxsdMatmQl8/dyP/bawkBMjrxcwmmyeu326cVVZ/Drebt3/vPFm38KM4MMxEeyC32kzEtiN7X5rVvCsSzh2LSAuYWsW8BLWcBLxULTmPq62K8k9qvGx9Zw2Gq/PeueD4+asrgH1OF7Wcj3bh20Fo6dCVi5RXjrLXmuSLcpD7G+ql0Xvi1G7aZh/1O23O8a34lhI0r0C+eqUf/Qp0RebaFuuCgc36yGKc4cBUJrwisXeE1WMIp+wiSVd/nRuXwj8TOK5V3hdqiKb1IUSGF4nOFsHGFzgl9ixokYOOti2AQef/+Dj2YAvKIkHFi5Vc3MmCF5k8y2z3YoKivOc3zoq9Hee5wl5J7JO70+YY6RnnqKdMKiD+M7OEa9xNH3A5AKBlB8de6/Xnx4Xvjfvj73m6yWLrGX/Pbi9avf627Cq9c/+Ak/vP7p93oB66fXRy98qKMXr38Hv+t5Z5Mq0fop5IK1OtAVUOth+cKtmqNcunArj4W7Ba9Xqi7N4EVWgtsPKYamE0/KbAQy7SMrq2YXcjNx5xkqjaid4tkNgXQti8uBy3Olhd5/aXLA3W1vlyKKiSsxL7J2is3p51CGLMHfY+PuounDRUqgMsDguAjcQIZ+eJWgmCSFN3f/xUgWqduM5B0uVhq60IPfXvxu9vWrAVEBwKEK3HPGZzy3yY1vyikysW74LBneX9431J3rYIDoJxyjaLBgHE17WYI+Rz/zCQ04yCqMRyyXnsigLVT7Zn94AJoVi3vKMm9wBulCvUNs7xMaBmbo5WPQ81g0BnOc8R9e3YxqBwdlmtskWaYouvSK4gbK/tqFSaMQ+fZvr1MHHRLPp+ooHRh0nOl/TzVedKq8WE94nGyJ1lxnBaNa0Zhk1fLFuE0dbzKMbWhFTjlGAz3Is/p88nDnEkiPWSr19G2OtKodnl+vpD6fFPT0lLLtUzJDlC/kuONhEvZR3Tj2wb9+7PlzMJzIV9FyeBCTdD7NGEgJuQMpvkMSTtkghVlCpspinys0KSNGwL16TX8G+ERhKFi5UAbI7S3gBOirvwDmYCaR04V+9F1JuINjvi/+yABGInkuS54EchfI2SzFfJ+hmX5IvzmqPXeeyo/u0OJAdAz+/NPebCbX8fStYqPAdWGSptkZIfgRdZPiCOw6UXHBjbfNDw0l/0hpJfoZ8gmi+bbhiky3JBVHnZLwHz6ymTqpoCyigxfKAumr8L3jBoH0Vfi6G1lE18nmGefSdp38kf+CGeib5mR5ufJK2jM3n/qRZKn7+97vOYCMAQB8UbuDlDc0RzVN//FtlLNdp2hloY0bATWEm4xKwIo3w3cYvsK7aR5TyiYaj/eE3jk9g+VO6gBYR8zTyk7m52kPsFnWawR3F/eZejqsmFYG73E0FRair0x0kAo5YVQz119ICrPVMseSWYG3PKOMqKXXmnMymE+nkC7K8c/J/Mu6grz7BmdjM8pZbfYljE2Y+IdGwGKqTcUO2PSp9iuK3bkfJzmE1PHPYIbS19E3AMBsWSuRfcSFnevp7YohauiekvEYZ+PVqgshbUZ7X+32xUbasGcuYBp4x5oqc9cur5sllaV5B6F8mzEgrdmsl4RwZcZXWU2hBHcnZEVlKydqVmBsOqh8+fI/AQAA///efah+cPgAAA=="
  LET Specs <= parse_json(data=gunzip(string=base64decode(string=SPEC)))
  LET CheckHeader(OSPath) = read_file(filename=OSPath, length=12) = "SQLite forma"
  LET Bool(Value) = if(condition=Value, then="Yes", else="No")

  -- In fast mode we check the filename, then the header then run the sqlite precondition
  LET matchFilename(SourceName, OSPath) = OSPath =~ get(item=Specs.sources, field=SourceName).filename
    AND CheckHeader(OSPath=OSPath)
    AND Identify(SourceName= SourceName, OSPath= OSPath)
    AND log(message=format(format="%v matched by filename %v",
            args=[OSPath, get(item=Specs.sources, field=SourceName).filename]))

  -- If the user wanted to also upload the file, do so now
  LET MaybeUpload(OSPath) = if(condition=AlsoUpload, then=upload(file=OSPath)) OR TRUE

  LET Identify(SourceName, OSPath) = SELECT if(
    condition=CheckHeader(OSPath=OSPath),
    then={
      SELECT *
      FROM sqlite(file=OSPath, query=get(item=Specs.sources, field=SourceName).id_query)
    }) AS Hits
  FROM scope()
  WHERE if(condition=Hits[0].Check = get(item=Specs.sources, field=SourceName).id_value,
    then= log(message="%v was identified as %v",
            args=[OSPath, get(item=Specs.sources, field=SourceName).Name]),
    else=log(message="%v was not identified as %v (got %v, wanted %v)",
             args=[OSPath, get(item=Specs.sources, field=SourceName).Name, str(str=Hits),
                   get(item=Specs.sources, field=SourceName).id_value]) AND FALSE)

  LET ApplyFile(SourceName) = SELECT * FROM foreach(row={
     SELECT OSPath FROM AllFiles
     WHERE if(condition=MatchFilename,  then=matchFilename(SourceName=SourceName, OSPath=OSPath),
      else=Identify(SourceName= SourceName, OSPath= OSPath))

  }, query={
     SELECT *, OSPath FROM sqlite(
        file=OSPath, query=get(item=Specs.sources, field=SourceName).SQL)
  })

  -- Filter for matching files without sqlite checks.
  LET FilterFile(SourceName) =
     SELECT OSPath FROM AllFiles
     WHERE if(condition=MatchFilename,
              then=OSPath =~ get(item=Specs.sources, field=SourceName).filename)

  -- Build a regex for all enabled categories.
  LET all_categories = SELECT _value FROM foreach(row=["All","MacOS","Chrome","Browser","Edge","Firefox","InternetExplorer","Windows"]) WHERE get(field=_value)
  LET category_regex <= join(sep="|", array=all_categories._value)
  LET AllGlobs <= filter(list=Specs.globs, condition="x=> x.tags =~ category_regex")
  LET _ <= log(message="Globs for category %v is %v", args=[category_regex, CustomGlob || AllGlobs.glob])
  LET AllFiles <= SELECT OSPath FROM glob(globs=CustomGlob || AllGlobs.glob)
    WHERE NOT IsDir AND MaybeUpload(OSPath=OSPath)

parameters:
- name: MatchFilename
  description: |
    If set we use the filename to detect the type of sqlite file.
    When unset we use heristics (slower)
  type: bool
  default: Y

- name: CustomGlob
  description: Specify this glob to select other files

- name: DateAfter
  description: Timebox output to rows after this time.
  type: timestamp
  default: "1970-01-01T00:00:00Z"

- name: DateBefore
  description: Timebox output to rows after this time.
  type: timestamp
  default: "2100-01-01T00:00:00Z"

- name: FilterRegex
  description: Filter critical rows by this regex
  type: regex
  default: .


- name: All
  description: Select targets with category All
  type: bool
  default: Y


- name: MacOS
  description: Select targets with category MacOS
  type: bool
  default: N


- name: Chrome
  description: Select targets with category Chrome
  type: bool
  default: N


- name: Browser
  description: Select targets with category Browser
  type: bool
  default: N


- name: Edge
  description: Select targets with category Edge
  type: bool
  default: N


- name: Firefox
  description: Select targets with category Firefox
  type: bool
  default: N


- name: InternetExplorer
  description: Select targets with category InternetExplorer
  type: bool
  default: N


- name: Windows
  description: Select targets with category Windows
  type: bool
  default: N


- name: SQLITE_ALWAYS_MAKE_TEMPFILE
  type: bool
  default: Y

- name: AlsoUpload
  description: If specified we also upload the identified file.
  type: bool

sources:
- name: AllFiles
  query: |
    SELECT * FROM AllFiles


- name: iMessage_Profiles
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="iMessage_Profiles")
    SELECT timestamp(epoch=date / 1000000000 + 978307200) AS Timestamp, *
    FROM Rows
    WHERE Timestamp > DateAfter AND Timestamp < DateBefore
      AND (MessageText, RoomName) =~ FilterRegex
    


- name: Chromium Browser Autofill_Profiles
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Autofill_Profiles")
    SELECT GUID,
      timestamp(epoch= date_modified) AS DateModified,
      timestamp(epoch= use_date) AS UseDate,
      FirstName, MiddleName, LastName, EmailAddress,
      PhoneNumber, CompanyName, StreetAddress,
      City, State, ZipCode, UseCount, OSPath
    FROM Rows
    WHERE UseDate > DateAfter AND UseDate < DateBefore
      AND (FirstName, MiddleName, LastName, EmailAddress, CompanyName, StreetAddress) =~ FilterRegex
    


- name: Chromium Browser Autofill_Masked Credit Cards
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Autofill_Masked Credit Cards")
    SELECT * FROM Rows


- name: Chromium Browser Bookmarks
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Chromium Browser Bookmarks")
    -- Recursive function to report the details of a folder
    LET ReportFolder(Data, BaseName) = SELECT * FROM chain(a={
      -- First row emit the data about the actual folder
      SELECT BaseName + " | " + Data.name AS Name,
             timestamp(winfiletime=int(int=Data.date_added) * 10) AS DateAdded,
             timestamp(winfiletime=int(int=Data.date_last_used) * 10) AS DateLastUsed,
             Data.type AS Type,
             Data.url || ""  AS URL
      FROM scope()
    },
    b={
       -- If this folder has children recurse into it
       SELECT * FROM foreach(row={
          SELECT _value FROM items(item=Data.children)
       },  query={
          SELECT * FROM ReportFolder(Data=_value, BaseName=BaseName + " | " + Data.name)
       })
    })
    
    LET MatchingFiles = SELECT OSPath, parse_json(data=read_file(filename=OSPath)) AS Data
    FROM Rows
    
    SELECT * FROM foreach(row=MatchingFiles, query={
      SELECT * FROM chain(
      a={
        SELECT OSPath, *, "bookmark_bar" AS Type
        FROM ReportFolder(Data=Data.roots.bookmark_bar, BaseName="")
      },
      b={
        SELECT OSPath, *, "other" AS Type
        FROM ReportFolder(Data=Data.roots.other, BaseName="")
      },
      c={
        SELECT OSPath, *, "synced" AS Type
        FROM ReportFolder(Data=Data.roots.synced, BaseName="")
      })
    })
    


- name: Chromium Browser_Cookies
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser_Cookies")
    SELECT timestamp(winfiletime=(creation_utc * 10) || 0) AS CreationUTC,
           timestamp(winfiletime=(expires_utc * 10) || 0) AS ExpiresUTC,
           timestamp(winfiletime=(last_access_utc * 10) || 0) AS LastAccessUTC,
           HostKey, Name, Path,
           Bool(Value=is_secure) AS IsSecure,
           Bool(Value=is_httponly) AS IsHttpOnly,
           Bool(Value=has_expires) AS HasExpiration,
           Bool(Value=is_persistent) AS IsPersistent,
           Priority, SourcePort, OSPath
    FROM Rows
    WHERE LastAccessUTC > DateAfter AND LastAccessUTC < DateBefore
      AND (Name, Path) =~ FilterRegex
    


- name: Chromium Browser Extensions
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Chromium Browser Extensions")
    -- Resolve the message string against the Locale dict
    LET ResolveName(Message, Locale) = get(item=Locale,
          field=lowcase(string=parse_string_with_regex(regex="^__MSG_(.+)__$", string=Message).g1),
          default=Message).message || Message
    
    -- Read the manifest files
    LET ManifestData = SELECT OSPath, parse_json(data=read_file(filename=OSPath)) AS Manifest
    FROM Rows
    
    -- Find the Locale file to help with.
    LET LocaleData = SELECT *, if(condition=Manifest.default_locale, else=dict(),
         then=parse_json(data=read_file(
            filename=OSPath.Dirname + "_locales" + Manifest.default_locale + "messages.json"))) AS Locale
    FROM ManifestData
    
    LET GetIcon(Manifest) = Manifest.icons.`128` || Manifest.icons.`64` || Manifest.icons.`32` || Manifest.icons.`16`
    
    SELECT OSPath, Manifest.author.email AS Email,
      ResolveName(Message = Manifest.name, Locale=Locale) AS name,
      ResolveName(Message = Manifest.description, Locale=Locale) AS description,
      Manifest.oauth2.scopes as Scopes,
      Manifest.permissions as Permissions,
      Manifest.key as Key, if(condition=GetIcon(Manifest=Manifest),
                then=upload(file=OSPath.Dirname + GetIcon(Manifest=Manifest))) AS Image,
      Manifest AS _Manifest
    FROM LocaleData
    WHERE (name, description) =~ FilterRegex
    


- name: Chromium Browser Favicons
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Favicons")
    SELECT ID, IconID,
      timestamp(winfiletime= (LastUpdated * 10) || 0) AS LastUpdated,
      PageURL, FaviconURL,
      upload(accessor="data",
         file=_image,
         name=format(format="Image%v.png", args=ID)) AS Image,
      OSPath as _OSPath
    FROM Rows
    WHERE LastUpdated > DateAfter AND LastUpdated < DateBefore
    


- name: Chromium Browser History_Visits
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser History_Visits")
    SELECT ID,
       timestamp(winfiletime=(visit_time * 10) || 0) AS VisitTime,
       timestamp(winfiletime=(last_visit_time * 10) || 0) AS LastVisitedTime,
       URLTitle, URL, VisitCount, TypedCount,
       if(condition=hidden =~ '1', then="Yes", else="No") AS Hidden,
       VisitID, FromVisitID,
       visit_duration / 1000000 AS VisitDurationInSeconds,
       OSPath
    FROM Rows
    WHERE VisitTime > DateAfter
      AND VisitTime < DateBefore
      AND (URLTitle, URL) =~ FilterRegex
    


- name: Chromium Browser History_Downloads
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser History_Downloads")
    LET StateLookup <= dict(`0`='In Progress', `1`='Complete', `2`="Cancelled", `3`="Interrupted", `4`="Interrupted")
    LET DangerType <= dict(`0`='Not Dangerous', `1`="Dangerous", `2`='Dangerous URL', `3`='Dangerous Content',
        `4`='Content May Be Malicious', `5`='Uncommon Content', `6`='Dangerous But User Validated',
        `7`='Dangerous Host', `8`='Potentially Unwanted', `9`='Whitelisted by Policy')
    LET InterruptReason <= dict(`0`= 'No Interrupt', `1`= 'File Error', `2`='Access Denied', `3`='Disk Full',
      `5`='Path Too Long',`6`='File Too Large', `7`='Virus', `10`='Temporary Problem', `11`='Blocked',
      `12`='Security Check Failed', `13`='Resume Error', `20`='Network Error', `21`='Operation Timed Out',
      `22`='Connection Lost', `23`='Server Down', `30`='Server Error', `31`='Range Request Error',
      `32`='Server Precondition Error', `33`='Unable to get file', `34`='Server Unauthorized',
      `35`='Server Certificate Problem', `36`='Server Access Forbidden', `37`='Server Unreachable',
      `38`='Content Length Mismatch', `39`='Cross Origin Redirect', `40`='Cancelled', `41`='Browser Shutdown',
      `50`='Browser Crashed')
    
    SELECT ID, GUID, CurrentPath, TargetPath, OriginalMIMEType, ReceivedBytes, TotalBytes,
      timestamp(winfiletime=(start_time * 10) || 0) AS StartTime,
      timestamp(winfiletime=(end_time * 10) || 0) AS EndTime,
      timestamp(winfiletime=(opened * 10) || 0) AS Opened,
      timestamp(winfiletime=(last_access_time * 10) || 0) AS LastAccessTime,
      timestamp(epoch=last_modified) AS LastModified,
      get(item=StateLookup, field=str(str=state), default="Unknown") AS State,
      get(item=DangerType, field=str(str=danger_type), default="Unknown") AS DangerType,
      get(item=InterruptReason, field=str(str=interrupt_reason), default="Unknown") AS InterruptReason,
      ReferrerURL, SiteURL, TabURL, TabReferrerURL, DownloadURL, OSPath
    FROM Rows
    WHERE LastAccessTime > DateAfter AND LastAccessTime < DateBefore
      AND (SiteURL, DownloadURL, TabURL, TabReferrerURL, ReferrerURL, DownloadURL) =~ FilterRegex
    


- name: Chromium Browser History_Keywords
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser History_Keywords")
    SELECT KeywordID, URLID,
       timestamp(winfiletime=(last_visit_time * 10) || 0) AS LastVisitedTime,
       KeywordSearchTerm, Title, URL, OSPath
    FROM Rows
    WHERE LastVisitedTime > DateAfter AND LastVisitedTime < DateBefore
      AND (Title, KeywordSearchTerm, URL) =~ FilterRegex
    


- name: Chromium Browser Media_History
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Media_History")
    SELECT ID, URL, WatchTimeSeconds,
       Bool(Value=has_video) AS HasVideo,
       Bool(Value=has_audio) AS HasAudio,
       timestamp(winfiletime=last_updated_time_s || 0) AS LastUpdated,
       OriginID, OSPath
    FROM Rows
    WHERE LastUpdated > DateAfter AND LastUpdated < DateBefore
      AND URL =~ FilterRegex
    


- name: Chromium Browser Media_Playback Session
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Media_Playback Session")
    SELECT ID,
      timestamp(winfiletime=last_updated_time_s || 0) AS LastUpdated, URL,
      duration_ms / 1000 AS DurationInSeconds,
      position_ms / 1000 AS PositionInSeconds,
      Title, Artist, Album, SourceTitle, OriginID, OSPath
    FROM Rows
    WHERE LastUpdated > DateAfter AND LastUpdated < DateBefore
      AND URL =~ FilterRegex
    


- name: Chromium Browser Network_Predictor
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Network_Predictor")
    SELECT * FROM Rows
    WHERE UserText =~ FilterRegex
    


- name: Chromium Browser Notifications_Site Engagements
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Chromium Browser Notifications_Site Engagements")
    LET JSON = SELECT parse_json(data=read_file(filename=OSPath)) AS Data, OSPath FROM Rows
    
    SELECT * FROM foreach(row={
      SELECT OSPath, Data.profile.content_settings.exceptions AS exceptions FROM JSON
    },  query={
      SELECT _key AS Site,
         timestamp(winfiletime=int(int=_value.last_modified) * 10 || 0) AS LastModified,
         timestamp(winfiletime=int(int=_value.setting.lastEngagementTime) * 10 || 0) AS LastEngagementTime,
         OSPath
      FROM items(item=exceptions.site_engagement)
    })
    


- name: Chromium Browser Notifications_App Banners
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Chromium Browser Notifications_App Banners")
    LET JSON = SELECT parse_json(data=read_file(filename=OSPath)) AS Data, OSPath FROM Rows
    
    SELECT * FROM foreach(row={
      SELECT OSPath, Data.profile.content_settings.exceptions AS exceptions FROM JSON
    },  query={
      SELECT _key AS Site,
         timestamp(winfiletime=int(int=_value.last_modified) * 10 || 0) AS LastModified,
         {
           SELECT _key AS Site,
              timestamp(winfiletime=int(int=_value.couldShowBannerEvents) * 10 || 0) AS CouldShowBannerEvents,
              timestamp(winfiletime=int(int=_value.next_install_text_animation.last_shown) * 10 || 0) AS LastShown
           FROM items(item=_value.setting)
         } AS Setting,
         OSPath
      FROM items(item=exceptions.app_banner)
    })
    


- name: Chromium Browser Notifications_Notification Preferences
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Chromium Browser Notifications_Notification Preferences")
    LET ContentSettings <= array(`0`="Default",`1`="Allow",`2`="Block",`3`="Ask",`4`="Session Only",`5`="Detect Important Content")
    
    LET JSON = SELECT parse_json(data=read_file(filename=OSPath)) AS Data, OSPath FROM Rows
    
    SELECT * FROM foreach(row={
      SELECT OSPath, Data.profile.content_settings.exceptions AS exceptions FROM JSON
    },  query={
      SELECT _key AS Site,
        timestamp(winfiletime=int(int=_value.last_modified) * 10 || 0) AS LastModified,
        ContentSettings[_value.setting] AS Setting,
        OSPath
      FROM items(item=exceptions.notifications)
    })
    


- name: Chromium Browser Notifications_Notification Interactions
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Chromium Browser Notifications_Notification Interactions")
    LET JSON = SELECT parse_json(data=read_file(filename=OSPath)) AS Data, OSPath FROM Rows
    LET S = scope()
    
    SELECT * FROM foreach(row={
      SELECT OSPath, Data.profile.content_settings.exceptions AS exceptions FROM JSON
    },  query={
      SELECT _key AS URL,
        timestamp(winfiletime=int(int=_value.last_modified) * 10 || 0) AS LastModified,
        _value.display_count as DisplayCount,
        _value.click_count as ClickCount,
        OSPath
      FROM items(item=S.notification_interactions || dict())
    })
    


- name: Chromium Browser Shortcuts
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Shortcuts")
    SELECT ID,
      timestamp(winfiletime= (last_access_time * 10) || 0) AS LastAccessTime,
      TextTyped, FillIntoEdit, URL, Contents,
      Description, Type, Keyword, TimesSelectedByUser, OSPath
    FROM Rows
    WHERE LastAccessTime > DateAfter AND LastAccessTime < DateBefore
      AND (Contents, Description) =~ FilterRegex
    


- name: Chromium Sessions_Sessions
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Sessions_Sessions")
    SELECT timestamp(winfiletime=(creation_utc * 10) || 0) AS CreationUTC,
           timestamp(winfiletime=(expires_utc * 10) || 0) AS ExpiresUTC,
           timestamp(winfiletime=(last_access_utc * 10) || 0) AS LastAccessUTC,
           HostKey, Name, Path,
           Bool(Value=is_secure) AS IsSecure,
           Bool(Value=is_httponly) AS IsHttpOnly,
           Bool(Value=has_expires) AS HasExpiration,
           Bool(Value=is_persistent) AS IsPersistent,
           Priority, SourcePort, OSPath
    FROM Rows
    WHERE LastAccessUTC > DateAfter AND LastAccessUTC < DateBefore
      AND (Name, Path) =~ FilterRegex
    


- name: Chromium Browser Top Sites
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Top Sites")
    SELECT * FROM Rows
    WHERE ( URL =~ FilterRegex OR Title =~ FilterRegex )
    


- name: Edge Browser Navigation History_Navigation History
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Edge Browser Navigation History_Navigation History")
    SELECT ID,
       timestamp(epoch=`Last Visited Time`) AS `Last Visited Time`,
       Title, URL, VisitCount, OSPath
    FROM Rows
    WHERE `Last Visited Time` > DateAfter
      AND `Last Visited Time` < DateBefore
      AND (Title, URL) =~ FilterRegex
    


- name: Firefox Places
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Places")
    LET BookmarkTypes <= dict(`1`="URL", `2`="Folder", `3`="Separator")
    SELECT ID, ParentID,
       get(item= BookmarkTypes, field=str(str=type), default="Unknown") AS Type,
       timestamp(epoch=dateAdded) AS DateAdded,
       timestamp(epoch=lastModified) AS LastModified,
       Position, Title, URL, ForeignKey, OSPath
    FROM Rows
    WHERE LastModified > DateAfter AND LastModified < DateBefore
      AND (Title, URL) =~ FilterRegex
    


- name: Firefox Places_Downloads
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Places_Downloads")
    SELECT PlaceID, Content,
       timestamp(epoch=dateAdded) AS DateAdded,
       timestamp(epoch=lastModified) AS LastModified,
       OSPath
    FROM Rows
    WHERE LastModified > DateAfter AND LastModified < DateBefore
      AND Content =~ FilterRegex
    


- name: Firefox Places_History
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Places_History")
    LET VisitType <= dict(`1`='TRANSITION_LINK', `2`='TRANSITION_TYPED', `3`='TRANSITION_BOOKMARK',
      `4`='TRANSITION_EMBED', `5`= 'TRANSITION_REDIRECT_PERMANENT', `6`='TRANSITION_REDIRECT_TEMPORARY',
      `7`='TRANSITION_DOWNLOAD', `8`='TRANSITION_FRAMED_LINK', `9`='TRANSITION_RELOAD')
    
    SELECT VisitID, FromVisitID,
       timestamp(epoch= last_visit_date) AS LastVisitDate,
       VisitCount, URL, Title, Description,
       get(item= VisitType, field=str(str=visit_type), default="Unknown") AS VisitType,
       Bool(Value=hidden) AS Hidden,
       Bool(Value=typed) AS Typed,
       Frecency, PreviewImageURL, OSPath
    FROM Rows
    WHERE LastVisitDate > DateAfter AND LastVisitDate < DateBefore
      AND (Title, URL, Description) =~ FilterRegex
    


- name: Firefox Cookies
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Cookies")
    SELECT ID, Host, Name, Value,
       timestamp(epoch= creationTime) AS CreationTime,
       timestamp(epoch= lastAccessed) AS LastAccessedTime,
       timestamp(epoch= expiry) AS Expiration,
       Bool(Value= isSecure) AS IsSecure,
       Bool(Value= isHttpOnly) AS IsHTTPOnly, OSPath
    FROM Rows
    WHERE LastAccessedTime > DateAfter
      AND LastAccessedTime < DateBefore
      AND ( Name =~ FilterRegex OR Value =~ FilterRegex )
    


- name: Firefox Downloads
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Downloads")
    SELECT ID, Name, MIMEType, Source, Target,
       timestamp(epoch= startTime) AS StartTime,
       timestamp(epoch= endTime) AS EndTime,
       timestamp(epoch= expiry) AS Expiration,
       CurrentBytes, MaxBytes, OSPath
    FROM Rows
    WHERE StartTime > DateAfter
      AND StartTime < DateBefore
      AND Name =~ FilterRegex
    


- name: Firefox Favicons
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Favicons")
    SELECT ID, PageURL, FaviconURL,
       timestamp(epoch= expire_ms) AS Expiration,
       OSPath
    FROM Rows
    


- name: Firefox Form History
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Form History")
    SELECT ID, FieldName, Value, TimesUsed,
       timestamp(epoch= firstUsed) AS FirstUsed,
       timestamp(epoch= lastUsed) AS LastUsed,
       GUID, OSPath
    FROM Rows
    WHERE LastUsed > DateAfter AND LastUsed < DateBefore
      AND ( FieldName =~ FilterRegex OR Value =~ FilterRegex )
    


- name: IE or Edge WebCacheV01_All Data
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="IE or Edge WebCacheV01_All Data")
    LET MatchingFiles = SELECT OSPath FROM Rows
    
    LET Containers(OSPath) = SELECT Table
    FROM parse_ese_catalog(file=OSPath)
    WHERE Table =~ "Container_"
    GROUP BY Table
    
    LET AllHits(OSPath) = SELECT * FROM foreach(row={
        SELECT * FROM Containers(OSPath=OSPath)
    }, query={
       SELECT timestamp(winfiletime=ExpiryTime) AS ExpiryTime,
          timestamp(winfiletime=ModifiedTime) AS ModifiedTime,
          timestamp(winfiletime=AccessedTime) AS AccessedTime, Url, *
       FROM parse_ese(file=OSPath, table=Table)
    })
    
    SELECT * FROM foreach(row=MatchingFiles, query={
      SELECT * FROM AllHits(OSPath=OSPath)
    })
    WHERE AccessedTime > DateAfter AND AccessedTime < DateBefore
      AND Url =~ FilterRegex
    


- name: IE or Edge WebCacheV01_Highlights
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="IE or Edge WebCacheV01_Highlights")
    SELECT * FROM foreach(row=MatchingFiles, query={
      SELECT AccessedTime, ModifiedTime, ExpiryTime, Url
      FROM AllHits(OSPath=OSPath)
    })
    WHERE AccessedTime > DateAfter AND AccessedTime < DateBefore
      AND Url =~ FilterRegex
    


- name: MacOS Applications Cache
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="MacOS Applications Cache")
    SELECT
       time_stamp AS Timestamp,
       OSPath.Base AS Application,
       entry_ID AS EntryID,
       version AS Version,
       hash_value AS Hash,
       storage_policy AS StoragePolicy,
       request_key AS URL,
       plist(file=request_object, accessor="data") AS Request,
       plist(file=response_object, accessor="data") AS Response,
       partition AS Partition,
       OSPath
    FROM Rows
    WHERE Timestamp > DateAfter AND Timestamp < DateBefore
      AND Application =~ FilterRegex
    


- name: MacOS NetworkUsage
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="MacOS NetworkUsage")
    SELECT timestamp(epoch= ZTIMESTAMP + 978307200) AS Timestamp,
      timestamp(epoch= ZFIRSTTIMESTAMP + 978307200) AS FirstTimestamp,
      timestamp(epoch= LIVE_USAGE_TIMESTAMP + 978307200) AS LiveUsageTimestamp,
      ZBUNDLENAME AS BundleID,
      ZPROCNAME AS ProcessName,
      ZWIFIIN AS WifiIn,
      ZWIFIOUT AS WifiOut,
      ZWWANIN AS WanIn,
      ZWWANOUT AS WandOut,
      ZWIREDIN AS WiredIn,
      ZWIREDOUT AS WiredOut,
      ZXIN AS _XIn,
      ZXOUT AS _XOut,
      Z_PK AS LiveUsageTableID
    FROM Rows
    


- name: MacOS Notes
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="MacOS Notes")
    SELECT Key AS _Key,
     OSPath[1] AS User,
     Note,
     Title,
     Snippet,
     NoteID AS _NoteID,
     timestamp(cocoatime=CreatedTS) AS CreatedTime,
     timestamp(cocoatime=LastOpenedDate) AS LastOpenedTime,
     timestamp(cocoatime=DirModificationDate) AS LastDirModifcation,
     Account AS _Account,
     Directory,
     DirectoryID,
     AttachmentName,
     AttachmentSize,
     AttachmentUUID,
     if(condition=AttachmentUUID,
        then=OSPath[:2] + '/Library/Group Containers/group.com.apple.notes/Accounts/LocalAccount/Media/' + AttachmentUUID + '/' + AttachmentName) AS AttachmentLocation,
     AccountName AS _AccountName,
     AccountID AS _AccountID,
     AccountType AS _AccountType,
     gunzip(string=Data) AS Data,
     OSPath
    FROM Rows
    WHERE LastOpenedTime > DateAfter AND LastOpenedTime < DateBefore
      AND ( Title =~ FilterRegex OR Data =~ FilterRegex )
    


- name: MacOS XProtect Detections
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="MacOS XProtect Detections")
    SELECT *
    FROM Rows
    WHERE dt > DateAfter
      AND dt < DateBefore
      AND (violated_rule, exec_path, responsible_path, responsible_signing_id,
        exec_cdhash, exec_sha256, responsible_cdhash, responsible_sha256 ) =~ FilterRegex
    


- name: Windows Activities Cache_ActivityPackageId
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Windows Activities Cache_ActivityPackageId")
    SELECT format(format="%0X-%0X-%0X-%0X-%0X", args=[
      ActivityId[0:4], ActivityId[4:6], ActivityId[6:8],
      ActivityId[8:10], ActivityId[10:] ]) AS ActivityId,
      Platform, PackageName, ExpirationTime, OSPath
    FROM Rows
    


- name: Windows Activities Cache_Clipboard
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Windows Activities Cache_Clipboard")
    SELECT
      CreatedTime,
      timestamp(epoch=LastModifiedTime) AS LastModifiedTime,
      timestamp(epoch=LastModifiedOnClient) AS LastModifiedOnClient,
      StartTime,
      EndTime,
      Payload,
      OSPath[1] AS User,
      base64decode(string=parse_json_array(data=ClipboardPayload)[0].content) AS ClipboardPayload,
      OSPath AS Path,
      Mtime
    FROM Rows
    WHERE StartTime > DateAfter
      AND StartTime < DateBefore
      AND ClipboardPayload =~ FilterRegex
    


- name: Windows Search Service_SystemIndex_Gthr
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Windows Search Service_SystemIndex_Gthr")
    LET MatchingFiles = SELECT OSPath FROM Rows
    
    LET FormatTimeB(T) = timestamp(winfiletime=parse_binary(
       filename=T, accessor="data", struct="uint64b"))
    
    LET FormatTime(T) = timestamp(winfiletime=parse_binary(
       filename=T, accessor="data", struct="uint64"))
    
    LET FormatSize(T) = parse_binary(
       filename=T, accessor="data", struct="uint64")
    
    SELECT * FROM foreach(row=MatchingFiles, query={
       SELECT ScopeID, DocumentID, SDID,
          FormatTimeB(T=LastModified) AS LastModified,
          FileName
       FROM parse_ese(file=OSPath, table= "SystemIndex_Gthr")
    })
    WHERE LastModified > DateAfter AND LastModified < DateBefore
      AND FileName =~ FilterRegex
    


- name: Windows Search Service_SystemIndex_GthrPth
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Windows Search Service_SystemIndex_GthrPth")
    SELECT * FROM foreach(row=MatchingFiles, query={
       SELECT Scope, Parent, Name
       FROM parse_ese(file=OSPath, table= "SystemIndex_GthrPth")
    })
    WHERE Name =~ FilterRegex
    


- name: Windows Search Service_SystemIndex_PropertyStore
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Windows Search Service_SystemIndex_PropertyStore")
    LET X = scope()
    
    -- The PropertyStore columns look like
    -- <random>-ProperName so we strip the
    -- random part off to display it properly.
    LET FilterDict(Dict) = to_dict(item={
      SELECT split(sep_string="-", string=_key)[1] || _key AS _key, _value
      FROM items(item=Dict)
    })
    
    LET PropStore(OSPath) = SELECT *,
       FormatTime(T=X.System_Search_GatherTime) AS System_Search_GatherTime,
       FormatSize(T=X.System_Size) AS System_Size,
       FormatTime(T=X.System_DateModified) AS System_DateModified,
       FormatTime(T=X.System_DateAccessed) AS System_DateAccessed,
       FormatTime(T=X.System_DateCreated) AS System_DateCreated
    FROM foreach(row={
       SELECT *, FilterDict(Dict=_value) AS _value
       FROM items(item={
         SELECT * FROM parse_ese(file=OSPath, table="SystemIndex_PropertyStore")
      })
    }, column="_value")
    
    SELECT * FROM foreach(row=MatchingFiles, query={
       SELECT *
       FROM PropStore(OSPath=OSPath)
    })
    WHERE System_DateAccessed > DateAfter AND System_DateAccessed < DateBefore
    


- name: Windows Search Service_SystemIndex_PropertyStore_Highlights
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Windows Search Service_SystemIndex_PropertyStore_Highlights")
    SELECT * FROM foreach(row=MatchingFiles, query={
       SELECT WorkID,
          System_Search_GatherTime,
          System_Size,
          System_DateModified,
          System_DateCreated,
          X.System_FileOwner AS System_FileOwner,
          X.System_ItemPathDisplay AS System_ItemPathDisplay,
          X.System_ItemType AS System_ItemType,
          X.System_FileAttributes AS System_FileAttributes,
          X.System_Search_AutoSummary AS System_Search_AutoSummary
       FROM PropStore(OSPath=OSPath)
    })
    WHERE System_DateAccessed > DateAfter AND System_DateAccessed < DateBefore
    


- name: Windows Search Service_BrowsingActivity
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Windows Search Service_BrowsingActivity")
    SELECT * FROM foreach(row=MatchingFiles, query={
       SELECT X.ItemPathDisplay AS ItemPathDisplay,
          X.Activity_ContentUri AS Activity_ContentUri,
          X.Activity_Description AS Activity_Description
       FROM PropStore(OSPath=OSPath)
       WHERE Activity_ContentUri
    })
    


- name: Windows Search Service_UserActivityLogging
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Windows Search Service_UserActivityLogging")
    SELECT * FROM foreach(row=MatchingFiles, query={
       SELECT X.System_ItemPathDisplay AS System_ItemPathDisplay,
           FormatTime(T=X.ActivityHistory_StartTime) AS ActivityHistory_StartTime,
           FormatTime(T=X.ActivityHistory_EndTime) AS ActivityHistory_EndTime,
           X.ActivityHistory_AppId AS ActivityHistory_AppId
       FROM PropStore(OSPath=OSPath)
       WHERE ActivityHistory_AppId
    })
    WHERE ActivityHistory_StartTime > DateAfter
      AND ActivityHistory_StartTime < DateBefore
    



