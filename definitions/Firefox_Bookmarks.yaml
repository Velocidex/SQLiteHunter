Name: Firefox Places
Author: Andrew Rathbun
Email: andrew.d.rathbun@gmail.com
Reference: https://github.com/EricZimmerman/SQLECmd
SQLiteIdentifyQuery: |
  SELECT count(*) AS `Check`
  FROM sqlite_master
  WHERE type='table'
     AND (name='moz_historyvisits' OR name='moz_bookmarks'
          OR name='moz_places' OR name='moz_inputhistory');
SQLiteIdentifyValue: 4
Categories:
  - Firefox
  - Browser

FilenameRegex: "places.sqlite"
Globs:
  - "{{WindowsFirefoxProfiles}}/*/places.sqlite"
  - "{{LinuxFirefoxProfiles}}/places.sqlite"
  - "{{MacOSFirefoxProfiles}}/*/places.sqlite"

Sources:
- name: Bookmarks
  Preamble: |
    LET BookmarkTypes <= dict(`1`='URL', `2`='Folder', `3`='Separator')

  VQL: |
    SELECT ID, ParentID,
       get(item= BookmarkTypes, field=str(str=type), default="Unknown") AS Type,
       timestamp(epoch=dateAdded) AS DateAdded,
       timestamp(epoch=lastModified) AS LastModified,
       Position, Title, URL, ForeignKey, OSPath
    FROM Rows
    WHERE LastModified > DateAfter AND LastModified < DateBefore
      AND (Title, URL) =~ FilterRegex

  SQL: |
    SELECT
      Bookmarks.id AS ID,
      Bookmarks.parent AS ParentID,
      Bookmarks.type,
      Bookmarks.dateAdded,
      Bookmarks.lastModified,
      Bookmarks.position AS Position,
      Bookmarks.title AS Title,
      moz_places.url AS URL,
      Bookmarks.fk AS ForeignKey
    FROM moz_bookmarks AS Bookmarks
    LEFT JOIN moz_places ON Bookmarks.fk = moz_places.id
    ORDER BY Bookmarks.id ASC

- name: Downloads
  VQL: |
    SELECT PlaceID, Content,
       timestamp(epoch=dateAdded) AS DateAdded,
       timestamp(epoch=lastModified) AS LastModified,
       OSPath
    FROM Rows
    WHERE LastModified > DateAfter AND LastModified < DateBefore
      AND Content =~ FilterRegex

  SQL: |
    SELECT
      moz_annos.place_id AS PlaceID,
      moz_annos.content AS Content,
      dateAdded,
      lastModified
    FROM moz_annos
    INNER JOIN moz_anno_attributes ON moz_annos.anno_attribute_id = moz_anno_attributes.id
    WHERE moz_anno_attributes.name IN ('downloads/destinationFileURI','downloads/destinationFileName','downloads/metaData')
    ORDER BY moz_annos.dateAdded ASC
